<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CORPORATE ESCAPE // NexCorp Tower</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ===== RESET & BASE ===== */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
  width: 100%; height: 100%;
  background: #000;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  font-family: 'Share Tech Mono', 'Courier New', monospace;
}

/* ===== 16:9 GAME WRAPPER ===== */
#game-wrapper {
  position: relative;
  width: 100vw;
  height: calc(100vw * 9 / 16);
  max-width: 1600px;
  max-height: 900px;
  background: #03080f;
  overflow: hidden;
  box-shadow: 0 0 80px rgba(0,255,255,0.15), 0 0 200px rgba(0,100,255,0.08);
  transition: box-shadow 0.3s;
}
@media (max-aspect-ratio: 16/9) {
  #game-wrapper { width: calc(100vh * 16 / 9); height: 100vh; }
}

/* ===== BACKGROUNDS ===== */
.bg-grid {
  position: absolute; inset: 0;
  background-image:
    linear-gradient(rgba(0,255,255,0.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,255,255,0.04) 1px, transparent 1px);
  background-size: 50px 50px;
  animation: grid-drift 25s linear infinite;
  z-index: 0;
}
@keyframes grid-drift { 0%{background-position:0 0} 100%{background-position:50px 50px} }

.bg-hex-grid {
  position: absolute; inset: 0; z-index: 1; pointer-events: none; opacity: 0.4;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='56' height='100' viewBox='0 0 56 100'%3E%3Cpath d='M28 66L0 50V18L28 2l28 16v32L28 66zm0 0v34' fill='none' stroke='rgba(0,255,255,0.06)' stroke-width='1'/%3E%3C/svg%3E");
  background-size: 56px 100px;
}
.bg-city { position:absolute; bottom:0; left:0; right:0; height:45%; z-index:1; pointer-events:none; }
.bg-city svg { width:100%; height:100%; display:block; }
.bg-glow {
  position:absolute; inset:0;
  background:
    radial-gradient(ellipse 60% 40% at 50% 100%, rgba(0,80,160,0.25) 0%, transparent 70%),
    radial-gradient(ellipse 30% 20% at 20% 110%, rgba(0,200,255,0.1) 0%, transparent 60%),
    radial-gradient(ellipse 30% 20% at 80% 110%, rgba(60,0,200,0.12) 0%, transparent 60%);
  z-index:2; pointer-events:none;
}
.bg-scanlines {
  position:absolute; inset:0;
  background: repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(0,0,0,0.12) 3px, rgba(0,0,0,0.12) 4px);
  z-index:98; pointer-events:none;
}

/* ===== HUD ===== */
#hud {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
  z-index: 50;
  pointer-events: none;
}
.hud-left, .hud-right { display:flex; align-items:center; gap:10px; }
.hud-center { flex:1; display:flex; align-items:center; justify-content:center; }
.hud-logo { font-family:'Orbitron',monospace; font-size:0.65rem; font-weight:700; letter-spacing:4px; color:rgba(0,255,255,0.5); text-transform:uppercase; }
.hud-floor { font-family:'Orbitron',monospace; font-size:clamp(0.75rem,1.6vw,1rem); font-weight:700; letter-spacing:3px; color:#0ff; text-shadow:0 0 10px #0ff; }
.hud-score { font-family:'Orbitron',monospace; font-size:clamp(0.75rem,1.6vw,1rem); font-weight:700; letter-spacing:3px; color:#ff0; text-shadow:0 0 10px #ff0; }
.hud-score.bounce { animation: score-bounce 0.4s ease; }
@keyframes score-bounce { 0%,100%{transform:scale(1)} 50%{transform:scale(1.4) translateY(-2px)} }
.hud-divider { width:1px; height:20px; background:linear-gradient(to bottom, transparent, #0ff4, transparent); }
.hud-battery-wrap { display:flex; align-items:center; gap:5px; font-size:0.6rem; color:#0f9; letter-spacing:2px; }
.battery-bar { display:flex; gap:2px; align-items:center; }
.battery-seg { width:9px; height:11px; background:#0f9; border:1px solid #0f96; box-shadow:0 0 4px #0f96; }
.battery-seg.empty { background:transparent; border-color:#0f93; box-shadow:none; }
.battery-cap { width:3px; height:6px; background:#0f96; border-radius:0 1px 1px 0; }
.hud-rec { display:flex; align-items:center; gap:4px; font-size:0.65rem; color:#f55; letter-spacing:3px; }
.rec-dot { width:6px; height:6px; background:#f55; border-radius:50%; box-shadow:0 0 6px #f55; animation:blink 1.2s step-end infinite; }
.hud-clock { font-family:'Orbitron',monospace; font-size:0.65rem; color:rgba(0,255,255,0.6); letter-spacing:2px; }
.hud-ticker-wrap { overflow:hidden; width:clamp(80px,18vw,200px); height:18px; }
.hud-ticker { display:inline-block; white-space:nowrap; font-size:0.45rem; color:rgba(0,255,255,0.35); letter-spacing:1px; animation:ticker-scroll 20s linear infinite; }
@keyframes ticker-scroll { 0%{transform:translateX(100%)} 100%{transform:translateX(-100%)} }
/* Progress dots */
#hud-progress { display:flex; gap:4px; align-items:center; }
.prog-dot { width:7px; height:7px; border-radius:50%; background:#333; border:1px solid #555; transition:all 0.3s; }
.prog-dot.done { background:#0f8; border-color:#0f8; box-shadow:0 0 4px #0f8; }
.prog-dot.current { background:#0ff; border-color:#0ff; box-shadow:0 0 6px #0ff; animation:blink 0.8s step-end infinite; }

/* EXIT button */
#exit-btn {
  font-family: 'Orbitron', monospace;
  font-size: 0.55rem;
  letter-spacing: 2px;
  color: #0ff;
  background: rgba(0,0,0,0.6);
  border: 1px solid rgba(0,255,255,0.4);
  padding: 4px 9px;
  cursor: pointer;
  pointer-events: all;
  transition: all 0.2s;
  text-transform: uppercase;
}
#exit-btn:hover { border-color:#0ff; color:#fff; box-shadow:0 0 8px rgba(0,255,255,0.4); }

/* ===== SCREENS ===== */
.screen {
  position: absolute; inset: 0;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  opacity: 0; pointer-events: none;
  transition: opacity 0.4s ease;
  z-index: 10;
  padding-top: 56px;
  padding-bottom: 4px;
}
.screen.active { opacity:1; pointer-events:all; }

/* Per-type entrance animations */
@keyframes bootFadeIn { from{opacity:0;filter:brightness(0) blur(4px)} to{opacity:1;filter:brightness(1) blur(0)} }
.anim-boot { animation: bootFadeIn 1s ease forwards; }
@keyframes dataWipeIn { 0%{clip-path:inset(0 100% 0 0);opacity:0.3} 100%{clip-path:inset(0 0% 0 0);opacity:1} }
.anim-wipe { animation: dataWipeIn 0.5s cubic-bezier(0.77,0,0.175,1) forwards; }
@keyframes blindsIn { 0%{clip-path:inset(0 0 100% 0)} 100%{clip-path:inset(0 0 0% 0)} }
.anim-blinds { animation: blindsIn 0.45s ease forwards; }
@keyframes zoomIn { from{transform:scale(0.6);opacity:0} to{transform:scale(1);opacity:1} }
.anim-zoom { animation: zoomIn 0.4s cubic-bezier(0.34,1.56,0.64,1) forwards; }
@keyframes matchSlideIn { from{transform:translateY(40px);opacity:0} to{transform:translateY(0);opacity:1} }
.anim-match { animation: matchSlideIn 0.4s ease forwards; }
@keyframes winExplode { 0%{transform:scale(0.3);opacity:0} 60%{transform:scale(1.05);opacity:1} 100%{transform:scale(1);opacity:1} }
.anim-win { animation: winExplode 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards; }

/* ===== GLITCH ===== */
.glitch { position:relative; animation:glitch-main 2.5s infinite; }
.glitch::before, .glitch::after { content:attr(data-text); position:absolute; top:0; left:0; width:100%; overflow:hidden; }
.glitch::before { color:#0ff; clip-path:polygon(0 15%,100% 15%,100% 30%,0 30%); animation:glitch-top 2.5s infinite; opacity:0.8; }
.glitch::after  { color:#f0f; clip-path:polygon(0 65%,100% 65%,100% 80%,0 80%); animation:glitch-bot 2.5s infinite; opacity:0.8; }
@keyframes glitch-main { 0%,82%,100%{transform:none} 84%{transform:skewX(-3deg) scaleX(1.01)} 86%{transform:skewX(3deg)} 88%{transform:skewX(-1deg)} 90%{transform:none} }
@keyframes glitch-top { 0%,81%,100%{transform:none;opacity:0} 82%{transform:translate(-4px,2px);opacity:0.8;color:#f0f} 84%{transform:translate(4px,-2px);opacity:0.8;color:#0ff} 86%{transform:none;opacity:0} }
@keyframes glitch-bot { 0%,80%,100%{transform:none;opacity:0} 81%{transform:translate(4px,2px);opacity:0.8;color:#ff0} 83%{transform:translate(-4px,-2px);opacity:0.8;color:#f0f} 85%{transform:none;opacity:0} }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
@keyframes pulse-glow { 0%,100%{filter:drop-shadow(0 0 16px rgba(0,255,255,0.5))} 50%{filter:drop-shadow(0 0 32px rgba(0,255,255,0.9))} }

/* ===== BOOT SCREEN ===== */
#screen-boot { gap:10px; background:radial-gradient(ellipse 80% 60% at 50% 60%, #050d1a 0%, #000 100%); }
.boot-logo-wrap { margin-bottom:4px; filter:drop-shadow(0 0 20px rgba(0,255,255,0.6)); animation:pulse-glow 3s ease-in-out infinite; }
.boot-title { font-family:'Orbitron',monospace; font-weight:900; font-size:clamp(1.8rem,5vw,3.5rem); color:#fff; letter-spacing:8px; text-transform:uppercase; text-shadow:0 0 20px #0ff,0 0 40px #0ff8,0 0 80px #0ff4; }
.boot-subtitle { font-size:clamp(0.8rem,2vw,1.2rem); color:rgba(0,255,255,0.6); letter-spacing:6px; text-transform:uppercase; }
.boot-version { font-size:0.65rem; color:rgba(0,255,255,0.3); letter-spacing:3px; margin-top:2px; }
.boot-prompt { font-size:clamp(0.75rem,1.8vw,1rem); color:#0ff; letter-spacing:4px; animation:blink 1s step-end infinite; margin-top:10px; }
.boot-terminal { font-size:clamp(0.45rem,1vw,0.6rem); color:rgba(0,255,255,0.5); letter-spacing:1px; line-height:1.8; text-align:left; width:clamp(200px,55vw,480px); max-height:90px; overflow:hidden; margin-bottom:2px; }
.boot-terminal .bt-line { opacity:0; animation:bt-appear 0.1s forwards; }
@keyframes bt-appear { to{opacity:1} }

/* ===== CONTENT PANEL ===== */
.content-panel {
  background: rgba(0,8,20,0.88);
  border: 1px solid rgba(0,255,255,0.15);
  backdrop-filter: blur(6px);
  padding: clamp(12px,2vw,22px);
  max-width: 720px; width: 92%;
  max-height: calc(78vh - 56px);
  overflow-y: auto;
  box-shadow: 0 0 0 1px rgba(0,255,255,0.06), 0 0 40px rgba(0,255,255,0.05), inset 0 0 20px rgba(0,10,30,0.5);
  position: relative;
}
/* Unit color accent bar */
.content-panel::before {
  content: '';
  display: block;
  height: 2px;
  background: var(--unit-color, linear-gradient(90deg, transparent, #0ff, transparent));
  margin-bottom: 10px;
}
/* Scrollbar */
.content-panel::-webkit-scrollbar { width:4px; }
.content-panel::-webkit-scrollbar-track { background:rgba(0,255,255,0.05); }
.content-panel::-webkit-scrollbar-thumb { background:rgba(0,255,255,0.3); border-radius:2px; }

/* Traveling border light */
@keyframes border-travel {
  0%   { background-position: 0% 0%, 100% 0%, 100% 100%, 0% 100%; }
  100% { background-position: 100% 0%, 100% 100%, 0% 100%, 0% 0%; }
}

/* ===== FLOOR HEADER ===== */
.floor-header {
  font-family: 'Orbitron', monospace;
  font-size: clamp(0.75rem,1.8vw,1.1rem);
  letter-spacing: 4px;
  color: #0ff;
  text-align: center;
  margin-bottom: 12px;
  text-shadow: 0 0 10px #0ff8;
}
.floor-header span.cn-text { font-size:0.7em; }
.unit-tag {
  display: inline-block;
  font-family: 'Orbitron', monospace;
  font-size: 0.55rem;
  letter-spacing: 2px;
  padding: 2px 7px;
  border: 1px solid currentColor;
  margin-bottom: 8px;
  opacity: 0.8;
  text-transform: uppercase;
}

/* ===== QUESTION BOX ===== */
.question-box {
  font-size: clamp(0.9rem,2vw,1.25rem);
  color: #b8d8f8;
  line-height: 1.6;
  text-align: center;
  padding: 14px;
  border: 1px solid rgba(0,255,255,0.1);
  background: rgba(0,255,255,0.03);
  margin-bottom: 12px;
}
.scenario-box {
  font-size: clamp(0.8rem,1.6vw,1rem);
  color: rgba(200,220,255,0.8);
  line-height: 1.6;
  text-align: left;
  padding: 10px 14px;
  border: 1px solid rgba(150,100,255,0.2);
  background: rgba(80,0,160,0.06);
  margin-bottom: 8px;
  font-style: italic;
}

/* ===== ANSWER BUTTONS (MCQ/Scenario) ===== */
.answers-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 7px;
}
@media (max-width: 500px) { .answers-grid { grid-template-columns: 1fr; } }
.answer-btn {
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(0.75rem,1.6vw,1rem);
  line-height: 1.4;
  color: #7ac;
  background: rgba(0,20,40,0.6);
  border: 1px solid rgba(0,180,255,0.25);
  padding: 9px 12px;
  cursor: pointer;
  text-align: left;
  transition: all 0.2s;
  clip-path: polygon(5px 0%,100% 0%,calc(100% - 5px) 100%,0% 100%);
  position: relative; overflow: hidden;
  min-height: 44px;
  overflow-wrap: break-word;
  word-break: break-word;
}
.answer-btn::before { content:''; position:absolute; top:0; left:-110%; width:100%; height:100%; background:linear-gradient(90deg,transparent,rgba(0,200,255,0.1),transparent); transition:left 0.4s; }
.answer-btn:not(:disabled):hover::before { left:110%; }
.answer-btn:not(:disabled):hover { border-color:#0ff; color:#fff; background:rgba(0,255,255,0.06); }
.answer-btn:disabled { cursor:default; }
.answer-btn.correct { border-color:#0f8!important; color:#0f8!important; background:rgba(0,200,100,0.1)!important; box-shadow:0 0 12px rgba(0,200,80,0.4)!important; }
.answer-btn.wrong   { border-color:#f44!important; color:#f44!important; background:rgba(255,50,50,0.1)!important; box-shadow:0 0 12px rgba(255,50,50,0.4)!important; animation:shake 0.5s ease; }
@keyframes shake { 0%,100%{transform:translateX(0)} 15%,45%,75%{transform:translateX(-7px)} 30%,60%,90%{transform:translateX(7px)} }

/* ===== TRUE/FALSE ===== */
.tf-buttons { display:flex; gap:14px; justify-content:center; margin-top:4px; }
.tf-btn {
  font-family: 'Orbitron', monospace;
  font-size: clamp(0.9rem,2vw,1.3rem);
  letter-spacing: 4px;
  font-weight: 700;
  padding: 14px 36px;
  cursor: pointer;
  border: 2px solid;
  background: transparent;
  transition: all 0.2s;
  min-height: 54px;
  clip-path: polygon(8px 0%,100% 0%,calc(100% - 8px) 100%,0% 100%);
}
.tf-btn.true-btn  { color:#0ff; border-color:rgba(0,255,255,0.4); }
.tf-btn.false-btn { color:#f80; border-color:rgba(255,128,0,0.4); }
.tf-btn:not(:disabled):hover { box-shadow:0 0 20px; opacity:1; }
.tf-btn.true-btn:not(:disabled):hover  { box-shadow:0 0 20px rgba(0,255,255,0.5); border-color:#0ff; color:#fff; }
.tf-btn.false-btn:not(:disabled):hover { box-shadow:0 0 20px rgba(255,128,0,0.5); border-color:#f80; color:#fff; }
.tf-btn:disabled { cursor:default; opacity:0.7; }
.tf-btn.correct { border-color:#0f8!important; color:#0f8!important; box-shadow:0 0 16px rgba(0,200,80,0.5)!important; }
.tf-btn.wrong   { border-color:#f44!important; color:#f44!important; box-shadow:0 0 16px rgba(255,50,50,0.5)!important; animation:shake 0.5s ease; }

/* ===== FILL IN BLANK ===== */
.fill-input-wrap { display:flex; gap:8px; align-items:stretch; margin-top:4px; }
.fill-input {
  flex:1;
  font-family: 'Share Tech Mono', monospace;
  font-size: clamp(0.9rem,1.8vw,1.15rem);
  color: #0ff;
  background: rgba(0,20,40,0.7);
  border: 1px solid rgba(0,255,255,0.3);
  padding: 10px 14px;
  outline: none;
  transition: border-color 0.2s;
  letter-spacing: 2px;
}
.fill-input:focus { border-color:#0ff; box-shadow:0 0 10px rgba(0,255,255,0.2); }
.fill-input::placeholder { color:rgba(0,255,255,0.25); }
.fill-submit {
  font-family: 'Orbitron', monospace;
  font-size: 0.7rem;
  letter-spacing: 2px;
  color: #0ff;
  background: rgba(0,20,40,0.8);
  border: 1px solid rgba(0,255,255,0.4);
  padding: 10px 18px;
  cursor: pointer;
  transition: all 0.2s;
  clip-path: polygon(5px 0%,100% 0%,calc(100% - 5px) 100%,0% 100%);
}
.fill-submit:hover { border-color:#0ff; color:#fff; box-shadow:0 0 12px rgba(0,255,255,0.3); }
.fill-hint { font-size:clamp(0.65rem,1.2vw,0.8rem); color:rgba(0,255,255,0.3); letter-spacing:1px; margin-top:6px; text-align:center; }
.fill-blank-highlight { color:#ff0; border-bottom:2px solid #ff0; padding:0 4px; }

/* ===== MATCHING ===== */
.match-wrapper {
  display: flex;
  gap: clamp(8px,2vw,20px);
  align-items: flex-start;
  width: 100%;
}
.match-col { flex:1; min-width:0; }
.match-col-label { font-family:'Orbitron',monospace; font-size:0.6rem; letter-spacing:3px; color:rgba(0,180,255,0.6); text-align:center; margin-bottom:8px; padding-bottom:5px; border-bottom:1px solid rgba(0,255,255,0.15); }
.match-item {
  font-size: clamp(0.7rem,1.4vw,0.9rem);
  color: #7ac;
  background: rgba(0,20,40,0.6);
  border: 1px solid rgba(0,180,255,0.25);
  padding: 7px 10px;
  margin-bottom: 5px;
  cursor: pointer;
  transition: all 0.2s;
  line-height: 1.3;
  min-height: 38px;
  overflow-wrap: break-word;
}
.match-item:hover { border-color:#0ff; color:#fff; background:rgba(0,255,255,0.06); }
.match-item.selected { border-color:#ff0!important; color:#ff0!important; background:rgba(255,255,0,0.06)!important; box-shadow:0 0 10px rgba(255,255,0,0.3)!important; }
.match-item.matched-correct { border-color:#0f8!important; color:#0f8!important; background:rgba(0,200,80,0.1)!important; cursor:default; }
.match-item.matched-wrong   { border-color:#f44!important; color:#f44!important; background:rgba(255,50,50,0.1)!important; animation:shake 0.4s ease; }
.match-item.disabled-item   { cursor:default; opacity:0.5; pointer-events:none; }

/* ===== FEEDBACK ===== */
.feedback-row { display:flex; justify-content:center; margin-top:12px; min-height:26px; }
.feedback-msg { font-size:clamp(0.75rem,1.4vw,0.95rem); letter-spacing:2px; padding:4px 12px; border:1px solid; }
.feedback-msg.ok  { color:#0f8; border-color:#0f84; background:rgba(0,200,80,0.06); }
.feedback-msg.err { color:#f44; border-color:#f444; background:rgba(255,50,50,0.06); }
.hidden { display:none!important; }

/* ===== CONTINUE BUTTON ===== */
.continue-btn {
  font-family: 'Orbitron', monospace;
  font-size: clamp(0.65rem,1.4vw,0.85rem);
  letter-spacing: 3px;
  text-transform: uppercase;
  color: #0ff;
  background: transparent;
  border: 2px solid rgba(0,255,255,0.4);
  padding: 9px 24px;
  cursor: pointer;
  transition: all 0.25s;
  clip-path: polygon(8px 0%,100% 0%,calc(100% - 8px) 100%,0% 100%);
  margin-top: 12px;
}
.continue-btn:hover { border-color:#0ff; color:#fff; box-shadow:0 0 20px rgba(0,255,255,0.3); }

/* ===== GENERIC BTN ===== */
.btn {
  font-family: 'Orbitron', monospace;
  font-size: clamp(0.7rem,1.5vw,0.9rem);
  letter-spacing: 3px;
  text-transform: uppercase;
  color: #0ff;
  background: transparent;
  border: 2px solid rgba(0,255,255,0.4);
  padding: 9px 22px;
  cursor: pointer;
  transition: all 0.25s;
  clip-path: polygon(8px 0%,100% 0%,calc(100% - 8px) 100%,0% 100%);
  position: relative; overflow: hidden;
}
.btn::before { content:''; position:absolute; top:0; left:-110%; width:100%; height:100%; background:linear-gradient(90deg,transparent,rgba(0,255,255,0.18),transparent); transition:left 0.5s; }
.btn:hover::before { left:110%; }
.btn:hover { border-color:#0ff; color:#fff; box-shadow:0 0 24px rgba(0,255,255,0.35); }
.btn:active { transform:scale(0.95); }

/* ===== DRAG AND DROP ===== */
#screen-floordnd .content-panel { max-width:860px; }
.dnd-wrapper { display:flex; gap:clamp(10px,2vw,22px); align-items:flex-start; }
.dnd-col { flex:1; min-width:0; }
.dnd-col-label { font-family:'Orbitron',monospace; font-size:0.6rem; letter-spacing:3px; color:rgba(0,180,255,0.6); text-align:center; margin-bottom:7px; padding-bottom:5px; border-bottom:1px solid rgba(0,255,255,0.15); }
@media (max-width: 600px) { .dnd-wrapper { flex-direction:column; } }
.data-drive {
  display:flex; align-items:center; gap:7px;
  background:linear-gradient(135deg,#061424 0%,#0c2040 100%);
  border:1px solid rgba(0,180,255,0.35);
  padding:6px 9px; margin-bottom:5px;
  cursor:grab;
  font-size:clamp(0.65rem,1.3vw,0.9rem);
  color:#7ce0ff;
  transition:all 0.2s;
  user-select:none;
  clip-path:polygon(4px 0%,100% 0%,calc(100% - 4px) 100%,0% 100%);
  overflow-wrap:break-word;
}
.data-drive:hover { border-color:#0ff; box-shadow:0 0 12px rgba(0,255,255,0.25); transform:translateX(3px); }
.data-drive.dragging { opacity:0.4; cursor:grabbing; }
.data-drive.placed { opacity:0.3; cursor:default; pointer-events:none; }
.drive-icon { font-size:0.75rem; flex-shrink:0; }
.drive-label { flex:1; line-height:1.3; }
.server-slot {
  display:flex; align-items:center; gap:7px;
  border:1px dashed rgba(0,180,80,0.4);
  min-height:36px;
  padding:5px 9px; margin-bottom:5px;
  font-size:clamp(0.55rem,1vw,0.72rem);
  color:rgba(0,180,80,0.5);
  transition:all 0.2s;
  background:rgba(0,20,10,0.4);
  clip-path:polygon(4px 0%,100% 0%,calc(100% - 4px) 100%,0% 100%);
  overflow-wrap:break-word;
}
.server-slot.drag-over { border-color:#0ff; background:rgba(0,255,255,0.07); box-shadow:0 0 10px rgba(0,255,255,0.3) inset; }
.server-slot.filled { border-style:solid; border-color:rgba(0,180,255,0.4); color:#7ce0ff; }
.server-slot.correct-slot { border-color:#0f8!important; background:rgba(0,200,80,0.1)!important; box-shadow:0 0 12px rgba(0,200,80,0.3)!important; animation:slot-accept 0.5s ease; }
.server-slot.wrong-slot   { border-color:#f44!important; background:rgba(255,50,50,0.1)!important; animation:flash-red 0.6s ease; }
@keyframes slot-accept { 0%{transform:scaleX(1)} 50%{transform:scaleX(1.03);box-shadow:0 0 20px rgba(0,255,128,0.6)} 100%{transform:scaleX(1)} }
@keyframes flash-red   { 0%,100%{background:rgba(255,50,50,0.1)} 50%{background:rgba(255,50,50,0.25)} }
.slot-num { font-family:'Orbitron',monospace; font-size:0.65rem; color:rgba(0,180,80,0.5); flex-shrink:0; width:14px; }
.slot-content { flex:1; line-height:1.3; }
.slot-empty-label { font-style:italic; opacity:0.5; font-size:0.6rem; }
.remove-btn { font-size:0.65rem; cursor:pointer; color:rgba(255,100,100,0.5); flex-shrink:0; background:none; border:none; padding:2px 4px; line-height:1; transition:color 0.15s; }
.remove-btn:hover { color:#f55; }
.dnd-actions { display:flex; justify-content:center; gap:12px; margin-top:8px; }

/* ===== DIALOGUE BOX ===== */
#dialogue-box {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 22%;
  background: rgba(0,5,18,0.93);
  border-top: 2px solid rgba(0,255,255,0.3);
  display: flex;
  align-items: center;
  padding: 8px 14px;
  gap: 12px;
  z-index: 60;
}
#dialogue-box.hidden { transform:translateY(100%); opacity:0; pointer-events:none; }
#dialogue-box:not(.hidden) { animation:materialize 0.4s ease forwards; }
@keyframes materialize { 0%{transform:translateY(20px) scaleY(0.8);opacity:0;filter:blur(4px)} 60%{transform:translateY(-3px) scaleY(1.02);opacity:0.9;filter:blur(0)} 100%{transform:translateY(0) scaleY(1);opacity:1;filter:blur(0)} }
#dialogue-box::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,#0ff,transparent); }
.aegis-avatar { flex-shrink:0; width:clamp(44px,6vw,68px); height:clamp(44px,6vw,68px); filter:drop-shadow(0 0 8px rgba(0,255,255,0.6)); animation:aegis-idle 3s ease-in-out infinite; }
@keyframes aegis-idle { 0%,100%{filter:drop-shadow(0 0 8px rgba(0,255,255,0.5))} 50%{filter:drop-shadow(0 0 18px rgba(0,255,255,0.9))} }
.aegis-avatar.talking { animation:aegis-talk 0.4s ease-in-out infinite; }
@keyframes aegis-talk { 0%,100%{transform:scale(1)} 50%{transform:scale(1.04)} }
.aegis-avatar.alarmed { filter:drop-shadow(0 0 12px rgba(255,50,50,0.8))!important; animation:aegis-alarm 0.3s ease-in-out infinite; }
@keyframes aegis-alarm { 0%,100%{transform:scale(1)} 50%{transform:scale(1.06)} }
.dialogue-content { flex:1; min-width:0; }
#dialogue-speaker { font-family:'Orbitron',monospace; font-size:clamp(0.55rem,1vw,0.7rem); letter-spacing:4px; color:#0ff; text-shadow:0 0 8px #0ff; margin-bottom:4px; }
#dialogue-text { font-size:clamp(0.78rem,1.5vw,1rem); color:#d0e8ff; line-height:1.5; min-height:2.2em; }
#dialogue-continue { font-size:0.65rem; color:rgba(0,255,255,0.55); letter-spacing:2px; margin-top:4px; animation:blink 1s step-end infinite; display:none; }

/* ===== WIN SCREEN ===== */
#screen-win { background:radial-gradient(ellipse 80% 60% at 50% 60%, #020d05 0%, #000 100%); gap:10px; }
.win-title { font-family:'Orbitron',monospace; font-weight:900; font-size:clamp(1.4rem,4vw,2.8rem); color:#0f8; letter-spacing:6px; text-shadow:0 0 20px #0f8,0 0 50px #0f84; animation:win-pulse 2s ease-in-out infinite; z-index:10; }
@keyframes win-pulse { 0%,100%{text-shadow:0 0 20px #0f8,0 0 50px #0f84} 50%{text-shadow:0 0 40px #0f8,0 0 80px #0f8,0 0 120px #0f86} }
.win-sub { font-size:clamp(0.6rem,1.3vw,0.8rem); color:rgba(0,255,128,0.6); letter-spacing:4px; text-align:center; z-index:10; }
.win-stats { font-size:clamp(0.55rem,1vw,0.7rem); color:rgba(0,255,128,0.45); letter-spacing:2px; text-align:center; z-index:10; }
.win-knowledge { z-index:10; max-width:600px; width:90%; background:rgba(0,20,10,0.7); border:1px solid rgba(0,200,80,0.2); padding:10px 14px; margin-top:4px; }
.win-knowledge-title { font-family:'Orbitron',monospace; font-size:0.6rem; letter-spacing:3px; color:rgba(0,255,128,0.7); margin-bottom:7px; }
.win-knowledge-list { font-size:0.6rem; color:rgba(0,255,128,0.5); line-height:1.8; columns:2; column-gap:16px; }
.win-helicopter { position:absolute; bottom:15%; font-size:clamp(1rem,2.5vw,1.8rem); opacity:0; animation:heli-rise 3s ease-out 0.5s forwards; filter:drop-shadow(0 0 8px rgba(0,255,128,0.8)); left:50%; transform:translateX(-50%); z-index:6; }
@keyframes heli-rise { 0%{bottom:5%;opacity:0} 30%{opacity:0.8} 100%{bottom:70%;opacity:0} }
@keyframes spin-rays { from{transform:translate(-50%,-50%) rotate(0deg)} to{transform:translate(-50%,-50%) rotate(360deg)} }

/* ===== FLOOR TRANSITION ===== */
.floor-transition { position:absolute; inset:0; background:rgba(0,2,10,0.96); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:200; gap:14px; }
.ft-hex { font-size:clamp(1.8rem,5vw,3.5rem); color:#0ff; animation:ft-spin 0.8s linear infinite; text-shadow:0 0 20px #0ff; }
@keyframes ft-spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
.ft-text { font-family:'Orbitron',monospace; font-size:clamp(0.7rem,1.8vw,1.1rem); color:#0ff; letter-spacing:6px; text-shadow:0 0 12px #0ff; }
.ft-cn   { font-family:'Noto Sans SC',sans-serif; font-size:clamp(0.55rem,1.3vw,0.8rem); color:rgba(100,220,255,0.65); letter-spacing:2px; }
.ft-bar-wrap { width:clamp(140px,30vw,260px); height:3px; background:rgba(0,255,255,0.15); border:1px solid rgba(0,255,255,0.3); }
.ft-bar { height:100%; width:0%; background:linear-gradient(90deg,#0ff,#0f8); box-shadow:0 0 6px #0ff; transition:width 0.7s ease; }

/* ===== OVERLAYS ===== */
.correct-overlay { position:absolute; inset:0; background:radial-gradient(circle at 50% 50%,rgba(0,255,128,0.18) 0%,transparent 70%); z-index:150; pointer-events:none; animation:correct-pulse 0.8s ease-out forwards; }
@keyframes correct-pulse { 0%{opacity:0;transform:scale(0.8)} 30%{opacity:1;transform:scale(1)} 100%{opacity:0;transform:scale(1.1)} }
.wrong-overlay { position:absolute; inset:0; background:rgba(255,30,30,0.2); z-index:150; pointer-events:none; animation:wrong-flash 0.6s ease-out forwards; }
@keyframes wrong-flash { 0%,40%{opacity:1} 100%{opacity:0} }
@keyframes screen-shake { 0%,100%{transform:translateX(0)} 15%,45%,75%{transform:translateX(-8px)} 30%,60%,90%{transform:translateX(8px)} }
#game-wrapper.shake { animation:screen-shake 0.5s ease; }

/* ===== EXIT MODAL ===== */
#exit-modal {
  position: absolute; inset: 0;
  background: rgba(0,0,0,0.7);
  display: flex; align-items: center; justify-content: center;
  z-index: 300;
  backdrop-filter: blur(4px);
}
.exit-modal-box {
  background: rgba(0,8,20,0.95);
  border: 2px solid rgba(0,255,255,0.4);
  padding: 28px 36px;
  text-align: center;
  box-shadow: 0 0 40px rgba(0,255,255,0.2);
  max-width: 380px; width: 85%;
}
.exit-modal-title { font-family:'Orbitron',monospace; font-size:clamp(0.9rem,2vw,1.2rem); font-weight:700; letter-spacing:5px; color:#0ff; text-shadow:0 0 12px #0ff; margin-bottom:6px; }
.exit-modal-sub   { font-family:'Noto Sans SC',sans-serif; font-size:0.8rem; color:rgba(100,200,255,0.6); letter-spacing:2px; margin-bottom:18px; }
.exit-modal-btns  { display:flex; gap:14px; justify-content:center; }
.exit-yes { font-family:'Orbitron',monospace; font-size:0.7rem; letter-spacing:3px; color:#f44; background:transparent; border:2px solid rgba(255,50,50,0.5); padding:8px 22px; cursor:pointer; clip-path:polygon(6px 0%,100% 0%,calc(100% - 6px) 100%,0% 100%); transition:all 0.2s; }
.exit-yes:hover { border-color:#f44; box-shadow:0 0 14px rgba(255,50,50,0.4); color:#fff; }
.exit-no  { font-family:'Orbitron',monospace; font-size:0.7rem; letter-spacing:3px; color:#0ff; background:transparent; border:2px solid rgba(0,255,255,0.5); padding:8px 22px; cursor:pointer; clip-path:polygon(6px 0%,100% 0%,calc(100% - 6px) 100%,0% 100%); transition:all 0.2s; }
.exit-no:hover  { border-color:#0ff; box-shadow:0 0 14px rgba(0,255,255,0.4); color:#fff; }

/* ===== BILINGUAL ===== */
.cn-text { display:block; font-family:'Noto Sans SC','PingFang SC','Microsoft YaHei',sans-serif; font-size:0.85em; color:rgba(100,220,255,0.65); margin-top:6px; font-weight:400; letter-spacing:0.5px; }
.type-cursor { animation:blink 0.6s step-end infinite; color:#0ff; }

/* ===== UTILITY ===== */
.tc { text-align:center; }
</style>
</head>
<body>
<div id="game-wrapper">

  <!-- ===== BACKGROUNDS ===== -->
  <div class="bg-grid"></div>
  <div class="bg-hex-grid"></div>
  <div class="bg-city">
    <svg viewBox="0 0 1280 260" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMax meet">
      <defs>
        <linearGradient id="sky-grad" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#000814" stop-opacity="0"/>
          <stop offset="100%" stop-color="#000814" stop-opacity="1"/>
        </linearGradient>
        <filter id="glow-city">
          <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
          <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>
      <g fill="#060d1a" filter="url(#glow-city)">
        <rect x="0" y="180" width="60" height="80"/><rect x="55" y="160" width="40" height="100"/>
        <rect x="90" y="140" width="55" height="120"/><rect x="140" y="170" width="35" height="90"/>
        <rect x="170" y="150" width="50" height="110"/><rect x="215" y="120" width="65" height="140"/>
        <rect x="275" y="160" width="40" height="100"/><rect x="310" y="100" width="80" height="160"/>
        <rect x="385" y="150" width="45" height="110"/><rect x="425" y="130" width="60" height="130"/>
        <rect x="480" y="80" width="90" height="180"/><rect x="565" y="140" width="50" height="120"/>
        <rect x="610" y="110" width="70" height="150"/><rect x="675" y="90" width="85" height="170"/>
        <rect x="755" y="150" width="45" height="110"/><rect x="795" y="120" width="65" height="140"/>
        <rect x="855" y="75" width="95" height="185"/><rect x="945" y="145" width="50" height="115"/>
        <rect x="990" y="105" width="75" height="155"/><rect x="1060" y="135" width="55" height="125"/>
        <rect x="1110" y="160" width="40" height="100"/><rect x="1145" y="115" width="70" height="145"/>
        <rect x="1210" y="155" width="45" height="105"/><rect x="1250" y="130" width="30" height="130"/>
      </g>
      <g>
        <rect x="488" y="100" width="4" height="3" fill="rgba(255,220,100,0.7)"/><rect x="496" y="100" width="4" height="3" fill="rgba(255,220,100,0.5)"/>
        <rect x="504" y="100" width="4" height="3" fill="rgba(255,220,100,0.7)"/><rect x="488" y="108" width="4" height="3" fill="rgba(255,220,100,0.4)"/>
        <rect x="862" y="90" width="4" height="3" fill="rgba(255,220,100,0.6)"/><rect x="870" y="90" width="4" height="3" fill="rgba(255,220,100,0.7)"/>
        <rect x="315" y="115" width="4" height="3" fill="rgba(100,200,255,0.5)"/><rect x="323" y="115" width="4" height="3" fill="rgba(100,200,255,0.7)"/>
        <rect x="683" y="105" width="4" height="3" fill="rgba(255,180,100,0.6)"/><rect x="691" y="105" width="4" height="3" fill="rgba(255,180,100,0.4)"/>
      </g>
      <rect x="0" y="245" width="1280" height="15" fill="rgba(0,80,160,0.15)"/>
      <rect x="0" y="0" width="1280" height="260" fill="url(#sky-grad)"/>
    </svg>
  </div>
  <div class="bg-glow"></div>
  <div class="bg-scanlines"></div>
  <canvas id="particles-canvas" style="position:absolute;inset:0;z-index:3;pointer-events:none;opacity:0.35;"></canvas>

  <!-- ===== HUD ===== -->
  <div id="hud">
    <div class="hud-left">
      <button id="exit-btn">&#9664; EXIT</button>
      <div class="hud-divider"></div>
      <div class="hud-logo">NexCorp Sec</div>
      <div class="hud-divider"></div>
      <div class="hud-floor" id="hud-floor">FLOOR 0</div>
      <div class="hud-divider"></div>
      <div class="hud-score" id="hud-score">SCR 0</div>
    </div>
    <div class="hud-center">
      <div id="hud-progress"></div>
      <div class="hud-ticker-wrap" style="margin-left:10px;"><div class="hud-ticker">NEXCORP SEC SYS v3.0 // BREACH ALERT // KNOWLEDGE VERIFICATION PROTOCOL ACTIVE // 安全验证协议 // AEGIS ONLINE //</div></div>
    </div>
    <div class="hud-right">
      <div class="hud-battery-wrap">
        <span>PWR</span>
        <div class="battery-bar" id="battery-bar">
          <div class="battery-seg" data-seg="1"></div><div class="battery-seg" data-seg="2"></div>
          <div class="battery-seg" data-seg="3"></div><div class="battery-seg" data-seg="4"></div>
          <div class="battery-seg" data-seg="5"></div><div class="battery-cap"></div>
        </div>
      </div>
      <div class="hud-divider"></div>
      <div class="hud-rec"><div class="rec-dot"></div>REC</div>
      <div class="hud-divider"></div>
      <div class="hud-clock" id="hud-clock">00:00:00</div>
    </div>
  </div>

  <!-- ===== SCREEN: BOOT ===== -->
  <div id="screen-boot" class="screen active">
    <div class="boot-logo-wrap">
      <svg width="80" height="80" viewBox="0 0 90 90" xmlns="http://www.w3.org/2000/svg">
        <circle cx="45" cy="45" r="44" fill="#050a14" stroke="#0ff" stroke-width="1.5" opacity="0.8"/>
        <circle cx="45" cy="45" r="36" fill="none" stroke="rgba(0,255,255,0.2)" stroke-width="1" stroke-dasharray="4 3"/>
        <polygon points="45,12 72,28 72,62 45,78 18,62 18,28" fill="none" stroke="#0ff" stroke-width="1.5" opacity="0.7"/>
        <circle cx="45" cy="45" r="14" fill="#061828" stroke="#0ff" stroke-width="1.5"/>
        <circle cx="45" cy="45" r="7" fill="#0ff" opacity="0.9"/>
        <circle cx="48" cy="42" r="2" fill="#fff" opacity="0.8"/>
        <line x1="31" y1="45" x2="59" y2="45" stroke="#0ff" stroke-width="0.7" opacity="0.5"/>
        <line x1="45" y1="6" x2="45" y2="10" stroke="#0ff" stroke-width="1.5" opacity="0.8"/>
        <line x1="45" y1="80" x2="45" y2="84" stroke="#0ff" stroke-width="1.5" opacity="0.8"/>
        <line x1="6" y1="45" x2="10" y2="45" stroke="#0ff" stroke-width="1.5" opacity="0.8"/>
        <line x1="80" y1="45" x2="84" y2="45" stroke="#0ff" stroke-width="1.5" opacity="0.8"/>
      </svg>
    </div>
    <h1 class="boot-title glitch" data-text="CORPORATE ESCAPE">CORPORATE ESCAPE</h1>
    <p class="boot-subtitle">NexCorp Tower &nbsp;//&nbsp; Security Breach Protocol</p>
    <p class="cn-text" style="text-align:center;font-size:clamp(0.55rem,1.4vw,0.8rem);letter-spacing:3px;color:rgba(0,255,255,0.45);margin-top:2px;">企业逃脱 // 奈克斯科普大厦入侵协议</p>
    <p class="boot-version">SYSTEM v3.0 &nbsp;|&nbsp; CLASSIFIED: TOP SECRET &nbsp;|&nbsp; 2026</p>
    <div id="boot-terminal" class="boot-terminal"></div>
    <p class="boot-prompt" id="boot-prompt">&#9654; PRESS ANY KEY OR CLICK TO BEGIN &#9664;<span class="cn-text" style="font-size:0.7em;display:inline;margin-left:8px;">按任意键或点击开始</span></p>
  </div>

  <!-- ===== SCREEN: QUESTION (shared for MCQ / TF / Fill / Scenario) ===== -->
  <div id="screen-question" class="screen">
    <div class="content-panel" id="question-panel">
      <div class="unit-tag" id="q-unit-tag">UNIT 0</div>
      <div class="floor-header" id="q-floor-header">FLOOR 01 // LOBBY TERMINAL</div>
      <div class="question-box" id="q-text"></div>
      <!-- MCQ/Scenario answers -->
      <div class="answers-grid hidden" id="q-mcq-answers"></div>
      <!-- TF buttons -->
      <div class="tf-buttons hidden" id="q-tf-buttons">
        <button class="tf-btn true-btn" id="tf-true">TRUE &#10003;<span class="cn-text" style="font-size:0.5em;display:inline;margin-left:6px;">真</span></button>
        <button class="tf-btn false-btn" id="tf-false">FALSE &#10007;<span class="cn-text" style="font-size:0.5em;display:inline;margin-left:6px;">假</span></button>
      </div>
      <!-- Fill in blank -->
      <div class="hidden" id="q-fill-area">
        <div class="fill-input-wrap">
          <input type="text" class="fill-input" id="fill-input" placeholder="TYPE YOUR ANSWER // 输入答案" autocomplete="off" spellcheck="false"/>
          <button class="fill-submit" id="fill-submit">SUBMIT &#9654;</button>
        </div>
        <div class="fill-hint" id="fill-hint"></div>
      </div>
      <div class="feedback-row" id="q-feedback-row">
        <div id="q-feedback" class="feedback-msg hidden"></div>
      </div>
      <div style="display:flex;justify-content:center;">
        <button class="continue-btn hidden" id="q-continue">CONTINUE &nbsp;&#9654;&#9654;<span class="cn-text" style="font-size:0.65em;display:inline;margin-left:6px;">继续</span></button>
      </div>
    </div>
  </div>

  <!-- ===== SCREEN: MATCHING ===== -->
  <div id="screen-match" class="screen">
    <div class="content-panel" id="match-panel" style="max-width:780px;">
      <div class="unit-tag" id="match-unit-tag">UNIT 2</div>
      <div class="floor-header" id="match-floor-header">MATCH PAIRS // 配对</div>
      <div class="question-box" id="match-instruction" style="font-size:clamp(0.75rem,1.5vw,0.95rem);">
        Match each term to its correct definition. Click a term, then click its definition.
        <span class="cn-text">将每个术语与其正确定义配对。点击术语，然后点击其定义。</span>
      </div>
      <div class="match-wrapper" id="match-wrapper">
        <div class="match-col">
          <div class="match-col-label">&#9664; TERMS &#9654; <span style="font-family:'Noto Sans SC',sans-serif;font-size:0.85em;">术语</span></div>
          <div id="match-terms"></div>
        </div>
        <div class="match-col">
          <div class="match-col-label">&#9664; DEFINITIONS &#9654; <span style="font-family:'Noto Sans SC',sans-serif;font-size:0.85em;">定义</span></div>
          <div id="match-defs"></div>
        </div>
      </div>
      <div class="feedback-row" style="margin-top:10px;">
        <div id="match-feedback" class="feedback-msg hidden"></div>
      </div>
      <div style="display:flex;justify-content:center;">
        <button class="continue-btn hidden" id="match-continue">CONTINUE &nbsp;&#9654;&#9654;</button>
      </div>
    </div>
  </div>

  <!-- ===== SCREEN: DRAG-AND-DROP (Final Floor) ===== -->
  <div id="screen-floordnd" class="screen">
    <div class="content-panel" style="max-width:860px;width:94%;">
      <div class="unit-tag" style="color:#08f;border-color:#08f;">UNIT 2 — FINAL CHALLENGE</div>
      <div class="floor-header" id="dnd-floor-header">
        &#9672;&nbsp; FINAL FLOOR &nbsp;// MAINFRAME CORE &nbsp;&#9672;
        <span class="cn-text">主机核心 — 最终挑战</span>
      </div>
      <div class="question-box" style="font-size:clamp(0.7rem,1.3vw,0.9rem);margin-bottom:10px;">
        Arrange the Australian Court Hierarchy — Slot 1 = HIGHEST, Slot 5 = LOWEST.
        Drag each court to its correct position.
        <span class="cn-text">排列澳大利亚法院层级——插槽1=最高权威，插槽5=最低。将每个法院拖到正确位置。</span>
      </div>
      <div class="dnd-wrapper">
        <div class="dnd-col" id="drives-col">
          <div class="dnd-col-label">&#9664; DATA DRIVES &#9654; <span style="font-family:'Noto Sans SC',sans-serif;font-size:0.8em;color:rgba(100,220,255,0.6);">数据驱动器</span></div>
          <div id="drives-container"></div>
        </div>
        <div class="dnd-col" id="slots-col">
          <div class="dnd-col-label">&#9664; SERVER SLOTS &#9654; <span style="font-family:'Noto Sans SC',sans-serif;font-size:0.8em;color:rgba(100,220,255,0.6);">服务器插槽</span></div>
          <div id="slots-container"></div>
        </div>
      </div>
      <div class="dnd-actions">
        <button class="btn" id="dnd-submit-btn">SUBMIT &nbsp;&#9654;&#9654; <span style="font-family:'Noto Sans SC',sans-serif;font-size:0.75em;">提交</span></button>
        <button class="btn" id="dnd-reset-btn" style="border-color:rgba(255,100,100,0.4);color:rgba(255,150,150,0.8);">RESET <span style="font-family:'Noto Sans SC',sans-serif;font-size:0.75em;">重置</span></button>
      </div>
      <div class="feedback-row" style="margin-top:6px;"><div id="dnd-feedback" class="feedback-msg hidden"></div></div>
    </div>
  </div>

  <!-- ===== SCREEN: WIN ===== -->
  <div id="screen-win" class="screen">
    <div style="position:absolute;inset:0;pointer-events:none;z-index:5;overflow:hidden;">
      <div style="position:absolute;top:50%;left:50%;width:700px;height:700px;transform:translate(-50%,-50%);
        background:conic-gradient(rgba(0,255,128,0.04) 0deg,transparent 10deg,rgba(0,255,128,0.04) 20deg,transparent 30deg,rgba(0,255,128,0.04) 40deg,transparent 50deg,rgba(0,255,128,0.04) 60deg,transparent 70deg,rgba(0,255,128,0.04) 80deg,transparent 90deg,rgba(0,255,128,0.04) 100deg,transparent 110deg,rgba(0,255,128,0.04) 120deg,transparent 130deg);
        animation:spin-rays 20s linear infinite;border-radius:50%;">
      </div>
    </div>
    <div class="win-helicopter" id="win-heli">&#x1F681;</div>
    <div class="win-title glitch" data-text="ACCESS GRANTED" style="z-index:10;">ACCESS GRANTED</div>
    <p class="win-sub" style="z-index:10;">ESCAPE SEQUENCE COMPLETE — NEXCORP TOWER UNLOCKED</p>
    <p class="win-sub cn-text" style="z-index:10;color:rgba(0,255,128,0.5);">逃脱序列完成 — 奈克斯科普大厦已解锁</p>
    <p class="win-stats" id="win-stats" style="z-index:10;margin-top:4px;"></p>
    <div class="win-knowledge" id="win-knowledge" style="z-index:10;">
      <div class="win-knowledge-title">&#9654; KNOWLEDGE GAINED THIS SESSION // 本次获取的知识</div>
      <div class="win-knowledge-list" id="win-knowledge-list"></div>
    </div>
    <div style="z-index:10;margin-top:14px;">
      <button class="btn" id="replay-btn" style="border-color:rgba(0,255,128,0.5);color:#0f8;">
        &#x21BA; &nbsp; PLAY AGAIN &nbsp;// 再玩一次
      </button>
    </div>
    <div style="z-index:10;margin-top:8px;font-size:0.65rem;color:rgba(0,255,128,0.4);letter-spacing:2px;text-align:center;">
      KNOWLEDGE IS THE KEY — WELL DONE, AGENT.
      <span class="cn-text" style="color:rgba(0,255,128,0.35);">知识是钥匙 — 干得好，特工。</span>
    </div>
  </div>

  <!-- ===== DIALOGUE BOX ===== -->
  <div id="dialogue-box" class="hidden">
    <svg class="aegis-avatar" id="aegis-svg" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
      <circle cx="40" cy="40" r="38" fill="#04091a" stroke="#0ff" stroke-width="1.5"/>
      <circle cx="40" cy="40" r="31" fill="none" stroke="rgba(0,255,255,0.15)" stroke-width="1" stroke-dasharray="5 3">
        <animateTransform attributeName="transform" type="rotate" from="0 40 40" to="360 40 40" dur="8s" repeatCount="indefinite"/>
      </circle>
      <circle cx="40" cy="40" r="26" fill="none" stroke="rgba(240,0,240,0.1)" stroke-width="1" stroke-dasharray="3 5">
        <animateTransform attributeName="transform" type="rotate" from="360 40 40" to="0 40 40" dur="5s" repeatCount="indefinite"/>
      </circle>
      <line x1="9" y1="40" x2="16" y2="40" stroke="#0ff" stroke-width="0.8" opacity="0.7"/>
      <line x1="64" y1="40" x2="71" y2="40" stroke="#0ff" stroke-width="0.8" opacity="0.7"/>
      <line x1="40" y1="9" x2="40" y2="16" stroke="#0ff" stroke-width="0.8" opacity="0.7"/>
      <line x1="40" y1="64" x2="40" y2="71" stroke="#0ff" stroke-width="0.8" opacity="0.7"/>
      <circle cx="40" cy="40" r="20" fill="#061420" stroke="#0ff" stroke-width="1.5"/>
      <circle cx="40" cy="40" r="15" fill="none" stroke="rgba(0,255,255,0.3)" stroke-width="0.7" stroke-dasharray="3 2"/>
      <circle cx="40" cy="40" r="9" fill="#0ff" opacity="0.95"/>
      <circle cx="44" cy="36" r="2.5" fill="white" opacity="0.75"/>
      <line x1="21" y1="40" x2="59" y2="40" stroke="#0ff" stroke-width="0.6" opacity="0.4">
        <animate attributeName="y1" values="30;50;30" dur="2.5s" repeatCount="indefinite"/>
        <animate attributeName="y2" values="30;50;30" dur="2.5s" repeatCount="indefinite"/>
      </line>
      <text x="40" y="72" text-anchor="middle" fill="rgba(0,255,255,0.4)" font-size="5" font-family="monospace">AEGIS v3.0</text>
    </svg>
    <div class="dialogue-content">
      <div id="dialogue-speaker">AEGIS</div>
      <div id="dialogue-text"></div>
      <div id="dialogue-continue">&#9660; CONTINUE</div>
    </div>
  </div>

  <!-- Floor transition overlay -->
  <div id="floor-transition" class="floor-transition hidden">
    <div class="ft-hex">&#x2B21;</div>
    <div class="ft-text" id="ft-text">ACCESSING NEXT FLOOR...</div>
    <div class="ft-cn" id="ft-cn">正在访问下一层...</div>
    <div class="ft-bar-wrap"><div class="ft-bar" id="ft-bar"></div></div>
  </div>

  <!-- Correct / Wrong overlays -->
  <div id="correct-overlay" class="correct-overlay hidden"></div>
  <div id="wrong-overlay" class="wrong-overlay hidden"></div>

  <!-- Exit confirmation modal -->
  <div id="exit-modal" class="hidden">
    <div class="exit-modal-box">
      <div class="exit-modal-title">ABORT MISSION?</div>
      <div class="exit-modal-sub">中止任务？</div>
      <p style="font-size:0.7rem;color:rgba(200,200,255,0.5);margin-bottom:16px;letter-spacing:1px;">Your progress will be lost. // 你的进度将丢失。</p>
      <div class="exit-modal-btns">
        <button class="exit-yes" id="exit-yes">YES // 是</button>
        <button class="exit-no" id="exit-no">NO // 否</button>
      </div>
    </div>
  </div>

</div><!-- end #game-wrapper -->
<script>
"use strict";

// ============================================================
//  SOUND FX — Web Audio API (no external files)
// ============================================================
const SoundFX = (() => {
  let ctx = null;
  function getCtx() {
    if (!ctx) {
      try { ctx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {}
    }
    return ctx;
  }
  function tone(freq, type, dur, vol=0.25, startFreq=null) {
    const c = getCtx(); if(!c) return;
    try {
      const o = c.createOscillator();
      const g = c.createGain();
      o.connect(g); g.connect(c.destination);
      o.type = type;
      o.frequency.setValueAtTime(startFreq||freq, c.currentTime);
      if(startFreq) o.frequency.linearRampToValueAtTime(freq, c.currentTime + dur);
      g.gain.setValueAtTime(vol, c.currentTime);
      g.gain.exponentialRampToValueAtTime(0.0001, c.currentTime + dur);
      o.start(c.currentTime);
      o.stop(c.currentTime + dur + 0.01);
    } catch(e) {}
  }
  return {
    playCorrect() { [523,659,784].forEach((f,i)=>setTimeout(()=>tone(f,'sine',0.09,0.22),i*80)); },
    playWrong()   { tone(100,'sawtooth',0.32,0.28); },
    playClick()   { tone(800,'sine',0.05,0.12); },
    playTransition() { tone(2000,'sine',0.4,0.18,200); },
    playBoot()    { [200,400,600,800,1200].forEach((f,i)=>setTimeout(()=>tone(f,'sine',0.1,0.18),i*110)); },
    playWin()     { [[261,0],[329,120],[392,240],[523,380],[659,550],[784,720]].forEach(([f,d])=>setTimeout(()=>tone(f,'sine',0.5,0.2),d)); },
    playType()    { tone(1800,'sine',0.02,0.06); },
    playDrag()    { tone(300,'sine',0.12,0.08); },
    playDrop()    { tone(160,'sine',0.12,0.28); },
  };
})();

// ============================================================
//  QUESTION BANK — 63 questions across Units 0-11
// ============================================================
// Types: 'mcq', 'tf', 'fill', 'match', 'scenario'
// Unit colors: 0=#888, 1=#4af, 2=#08f, 3=#fa0, 4=#0c8, 5=#0a6, 6=#f60, 7=#f30, 8=#a0f, 9-11=#0f9
const UNIT_COLORS = ['#888','#4af','#08f','#fa0','#0c8','#0a6','#f60','#f30','#a0f','#0f9','#0f9','#0f9'];
const UNIT_NAMES  = ['Unit 0: Intro','Unit 1: Legal Foundation','Unit 2: Legal System','Unit 3: Business Structures','Unit 4: Contracts I','Unit 5: Contracts II','Unit 6: Negligence I','Unit 7: Negligence II','Unit 8: Consumer Protection','Unit 9: Sustainability I','Unit 10: Sustainability II','Unit 11: Sustainability III'];

const QUESTION_BANK = [
// ── UNIT 0 ──────────────────────────────────────────────────
{ id:'u0q1', unit:0, type:'mcq', topic:'Course Learning Outcomes',
  en:'What does "CLO" stand for in this course?',
  zh:'"CLO"在本课程中代表什么？',
  opts:['Course Licensing Obligation','Course Learning Outcome','Corporate Law Overview','Curriculum Legal Objective'],
  optsZh:['课程许可义务','课程学习成果','公司法概述','课程法律目标'],
  ans:1,
  okEn:'Correct. CLO = Course Learning Outcome — the skills and knowledge you demonstrate by course end.',
  okZh:'正确。CLO代表课程学习成果——课程结束时应展示的技能和知识。',
  errEn:'Incorrect. CLO stands for Course Learning Outcome — specific skills assessed in this course.',
  errZh:'不正确。CLO代表课程学习成果——本课程中评估的具体技能。'},

{ id:'u0q2', unit:0, type:'tf', topic:'Course Overview',
  stmt:'Business Environments covers Units 0 through 8 only.',
  stmtZh:'《商业环境》课程仅覆盖第0至第8单元。',
  ans:false,
  okEn:'Correct — FALSE. The course covers Units 0 through 11, including three sustainability units (9, 10, 11).',
  okZh:'正确——假。该课程覆盖第0至第11单元，包括三个可持续发展单元（9、10、11）。',
  errEn:'FALSE. The course covers Units 0–11, including sustainability units 9, 10, and 11.',
  errZh:'假。该课程覆盖第0至第11单元，包括可持续发展单元9、10和11。'},

{ id:'u0q3', unit:0, type:'mcq', topic:'Assessment Structure',
  en:'Which assessment weight is typically correct for a group project in Business Environments?',
  zh:'《商业环境》课程中小组项目通常占多少分?',
  opts:['10%','20%','30%','40%'],
  optsZh:['10%','20%','30%','40%'],
  ans:2,
  okEn:'Correct. The group project is typically worth 30% of the overall grade.',
  okZh:'正确。小组项目通常占总成绩的30%。',
  errEn:'Incorrect. The group project is typically worth 30% of the overall grade.',
  errZh:'不正确。小组项目通常占总成绩的30%。'},

{ id:'u0q4', unit:0, type:'tf', topic:'Business Law Relevance',
  stmt:'Business law is only relevant to large corporations.',
  stmtZh:'商业法律仅与大型公司相关。',
  ans:false,
  okEn:'Correct — FALSE. Business law applies to all businesses, from sole traders to multinationals.',
  okZh:'正确——假。商业法律适用于所有企业，从个体经营者到跨国公司。',
  errEn:'FALSE. Business law applies to all businesses regardless of size.',
  errZh:'假。商业法律适用于所有规模的企业。'},

// ── UNIT 1 ──────────────────────────────────────────────────
{ id:'u1q1', unit:1, type:'mcq', topic:'Rule of Law',
  en:'Which of the following is NOT one of the five principles of the Rule of Law?',
  zh:'下列哪项不是法治五原则之一？',
  opts:['Equality before the law','Law is supreme over government','Majority rule determines law','Independent judiciary'],
  optsZh:['法律面前人人平等','法律高于政府','多数决定法律','独立的司法机构'],
  ans:2,
  okEn:'Correct. "Majority rule" is not a Rule of Law principle. The 5 principles include equality, supremacy of law, fair procedures, independent judiciary, and protection of rights.',
  okZh:'正确。"多数决定"不是法治原则。5项原则包括：平等、法律至上、公正程序、独立司法、权利保护。',
  errEn:'Incorrect. "Majority rule" is not a Rule of Law principle. The five principles are: equality before the law, law is supreme, fair procedures, independent judiciary, and protection of rights.',
  errZh:'不正确。"多数决定"不是法治原则。五项原则是：法律面前人人平等、法律至上、公正程序、独立司法、权利保护。'},

{ id:'u1q2', unit:1, type:'mcq', topic:'Separation of Powers',
  en:'The separation of powers doctrine divides government into how many branches?',
  zh:'权力分立原则将政府分为几个部门？',
  opts:['Two — executive and judiciary','Three — legislative, executive, judicial','Four — federal, state, local, judicial','Five — matching the Rule of Law principles'],
  optsZh:['两个——行政和司法','三个——立法、行政、司法','四个——联邦、州、地方、司法','五个——对应法治原则'],
  ans:1,
  okEn:'Correct. Three branches: Legislative (makes laws), Executive (implements laws), Judicial (interprets laws).',
  okZh:'正确。三个部门：立法机关（制定法律）、行政机关（执行法律）、司法机关（解释法律）。',
  errEn:'Incorrect. Three branches: Legislative, Executive, and Judicial.',
  errZh:'不正确。三个部门：立法机关、行政机关和司法机关。'},

{ id:'u1q3', unit:1, type:'fill', topic:'Division of Powers',
  blank:'The ___ of powers refers to the division of law-making authority between the federal government and state governments in Australia.',
  blankZh:'___权力是指澳大利亚联邦政府与州政府之间立法权力的划分。',
  accepts:['division','division of'],
  okEn:'Correct. The "division of powers" allocates powers between the Commonwealth and the states under the Constitution.',
  okZh:'正确。"权力划分"是宪法规定的联邦与州之间权力的分配。',
  errEn:'The answer is "division" — the division of powers splits authority between federal and state governments.',
  errZh:'答案是"division"（划分）——权力划分将权力分配给联邦和州政府。'},

{ id:'u1q4', unit:1, type:'mcq', topic:'Constitutional Law',
  en:'Which section of the Australian Constitution provides the mechanism for referendums?',
  zh:'澳大利亚宪法哪一条规定了公投机制？',
  opts:['s51','s109','s128','s7'],
  optsZh:['第51条','第109条','第128条','第7条'],
  ans:2,
  okEn:'Correct. Section 128 sets out the process for altering the Australian Constitution by referendum.',
  okZh:'正确。第128条规定了通过公投修改澳大利亚宪法的程序。',
  errEn:'Incorrect. Section 128 deals with referendums for constitutional amendments.',
  errZh:'不正确。第128条规定了宪法修正案的公投程序。'},

{ id:'u1q5', unit:1, type:'tf', topic:'Parliamentary Supremacy',
  stmt:'Under the Australian Constitution, the federal Parliament can override all state laws.',
  stmtZh:'根据澳大利亚宪法，联邦议会可以否决所有州法律。',
  ans:false,
  okEn:'Correct — FALSE. Federal Parliament can only override state laws in areas where it has constitutional power (s51). States retain residual powers.',
  okZh:'正确——假。联邦议会只能在其有宪法权力的领域（第51条）否决州法律。州保留剩余权力。',
  errEn:'FALSE. Federal Parliament can only override state laws in areas of its constitutional power. States keep residual powers.',
  errZh:'假。联邦议会只能在其宪法权力范围内否决州法律。州保留剩余权力。'},

{ id:'u1q6', unit:1, type:'mcq', topic:'High Court',
  en:'Under the Rule of Law, which court is responsible for ensuring the Australian Constitution is upheld?',
  zh:'在法治原则下，哪个法院负责确保澳大利亚宪法得到遵守？',
  opts:['Federal Circuit Court','Supreme Court of NSW','High Court of Australia','Administrative Appeals Tribunal'],
  optsZh:['联邦巡回法院','新南威尔士州最高法院','澳大利亚高等法院','行政上诉法庭'],
  ans:2,
  okEn:'Correct. The High Court of Australia is the apex court and guardian of the Constitution.',
  okZh:'正确。澳大利亚高等法院是最高法院，也是宪法的守护者。',
  errEn:'Incorrect. The High Court of Australia is the apex court and guardian of the Constitution.',
  errZh:'不正确。澳大利亚高等法院是最高法院和宪法的守护者。'},

// ── UNIT 2 ──────────────────────────────────────────────────
{ id:'u2q1', unit:2, type:'mcq', topic:'Sources of Law',
  en:'Which of the following is NOT a formal source of law in Australia?',
  zh:'下列哪项不是澳大利亚法律的正式来源？',
  opts:['Statute law (legislation)','Common law (case law)','Equity','Executive decrees'],
  optsZh:['成文法（立法）','普通法（判例法）','衡平法','行政命令'],
  ans:3,
  okEn:'Correct. The three formal sources of Australian law are statute law, common law, and equity. Executive decrees are not a formal independent source.',
  okZh:'正确。澳大利亚法律的三个正式来源是成文法、普通法和衡平法。行政命令不是独立的正式来源。',
  errEn:'Incorrect. The three formal sources are statute law, common law, and equity.',
  errZh:'不正确。三个正式来源是成文法、普通法和衡平法。'},

{ id:'u2q2', unit:2, type:'mcq', topic:'Court Hierarchy',
  en:'In the Australian court hierarchy, which court has the highest authority?',
  zh:'在澳大利亚法院层级中，哪个法院拥有最高权威？',
  opts:['Supreme Court (State)','Federal Court of Australia','High Court of Australia','Court of Appeal'],
  optsZh:['（州）最高法院','澳大利亚联邦法院','澳大利亚高等法院','上诉法院'],
  ans:2,
  okEn:'Correct. The High Court of Australia is the apex court — its decisions bind all other courts in Australia.',
  okZh:'正确。澳大利亚高等法院是最高法院——其判决对澳大利亚所有其他法院均有约束力。',
  errEn:'Incorrect. The High Court of Australia is the apex court whose decisions bind all lower courts.',
  errZh:'不正确。澳大利亚高等法院是最高法院，其判决对所有下级法院均有约束力。'},

{ id:'u2q3', unit:2, type:'fill', topic:'Precedent',
  blank:'"___ decidendi" is the Latin term for the binding legal reason(s) for a court\'s decision.',
  blankZh:'"___决定"是拉丁语，指法院判决的具有约束力的法律理由。',
  accepts:['ratio','Ratio'],
  okEn:'Correct. "Ratio decidendi" (reason for deciding) is the legally binding part of a judgment.',
  okZh:'正确。"Ratio decidendi"（判决理由）是判决中具有法律约束力的部分。',
  errEn:'The answer is "ratio" — ratio decidendi is the binding legal reason in a judgment.',
  errZh:'答案是"ratio"——ratio decidendi是判决中具有约束力的法律理由。'},

{ id:'u2q4', unit:2, type:'mcq', topic:'Postal Acceptance Rule',
  en:'Under the postal acceptance rule, acceptance of an offer is effective when:',
  zh:'根据邮政承诺规则，要约的承诺在何时生效？',
  opts:['The offeror reads the letter','The letter is received','The letter is posted (sent)','The offeror acknowledges receipt'],
  optsZh:['要约人阅读信件时','信件被收到时','信件被寄出时','要约人确认收到时'],
  ans:2,
  okEn:'Correct. Under the postal acceptance rule (Adams v Lindsell), acceptance is complete when the letter is posted, not when received.',
  okZh:'正确。根据邮政承诺规则（Adams v Lindsell），当信件寄出时承诺即完成，而非收到时。',
  errEn:'Incorrect. Under the postal rule, acceptance is effective from the moment the letter is posted.',
  errZh:'不正确。根据邮政规则，承诺从信件寄出时起生效。'},

{ id:'u2q5', unit:2, type:'mcq', topic:'Obiter Dictum',
  en:'"Obiter dictum" in a court judgment is:',
  zh:'法院判决中的"附带意见"是：',
  opts:['The binding ratio of the case','A non-binding comment made by a judge in passing','The headnote summarising the judgment','The written dissenting opinion'],
  optsZh:['案件的约束性理由','法官顺带发表的非约束性评论','概括判决的案例提要','书面异议意见'],
  ans:1,
  okEn:'Correct. Obiter dictum ("said by the way") is persuasive but not binding on future courts.',
  okZh:'正确。附带意见（"顺便说"）对未来法院具有说服力，但无约束力。',
  errEn:'Incorrect. Obiter dictum is a non-binding comment by a judge — only the ratio decidendi is binding.',
  errZh:'不正确。附带意见是法官的非约束性评论——只有判决理由具有约束力。'},

{ id:'u2q6', unit:2, type:'match', topic:'Precedent Concepts',
  en:'Match each legal term to its correct definition.',
  zh:'将每个法律术语与其正确定义配对。',
  pairs:[
    {term:'Ratio decidendi', def:'Binding reason for a court\'s decision'},
    {term:'Obiter dictum',   def:'Non-binding comment made in passing'},
    {term:'Stare decisis',   def:'Doctrine of binding precedent'},
    {term:'Appellate jurisdiction', def:'Power to hear appeals from lower courts'},
  ],
  pairsZh:[
    {term:'判决理由', def:'法院判决的约束性理由'},
    {term:'附带意见', def:'顺带发表的非约束性评论'},
    {term:'遵循先例', def:'约束性先例原则'},
    {term:'上诉管辖权', def:'审理下级法院上诉的权力'},
  ],
  okEn:'Excellent! All legal terms correctly matched.',
  okZh:'优秀！所有法律术语均正确匹配。',
  errEn:'Incorrect match. Review the definitions of each concept.',
  errZh:'匹配错误。请复习每个概念的定义。'},

// ── UNIT 3 ──────────────────────────────────────────────────
{ id:'u3q1', unit:3, type:'mcq', topic:'Sole Trader Liability',
  en:'Which business structure gives the owner UNLIMITED personal liability?',
  zh:'哪种商业结构使所有者承担无限个人责任？',
  opts:['Company (Pty Ltd)','Sole trader','Public company (Ltd)','Unit trust'],
  optsZh:['私人公司（Pty Ltd）','个体经营者','上市公司（Ltd）','单位信托'],
  ans:1,
  okEn:'Correct. A sole trader has no separate legal entity — the owner is personally liable for all business debts.',
  okZh:'正确。个体经营者没有独立的法人地位——所有者对所有商业债务承担个人责任。',
  errEn:'Incorrect. A sole trader bears unlimited personal liability for all business debts.',
  errZh:'不正确。个体经营者对所有商业债务承担无限个人责任。'},

{ id:'u3q2', unit:3, type:'mcq', topic:'Salomon v Salomon',
  en:'The landmark case Salomon v Salomon (1897) established that:',
  zh:'里程碑案例Salomon v Salomon（1897年）确立了：',
  opts:['Directors must act in good faith','A company is a separate legal entity from its shareholders','Partners have joint and several liability','A trustee must act in beneficiaries\' interests'],
  optsZh:['董事必须诚信行事','公司是独立于股东的法律实体','合伙人承担连带责任','受托人必须为受益人利益行事'],
  ans:1,
  okEn:'Correct. Salomon v Salomon established the "corporate veil" — a company has its own legal identity separate from its members.',
  okZh:'正确。Salomon v Salomon确立了"公司面纱"——公司拥有独立于其成员的法律身份。',
  errEn:'Incorrect. Salomon v Salomon established that a company is a separate legal entity distinct from its shareholders.',
  errZh:'不正确。Salomon v Salomon确立了公司是独立于股东的独立法律实体。'},

{ id:'u3q3', unit:3, type:'fill', topic:'Company Registration',
  blank:'Companies in Australia must be registered with ___, the national corporate regulator.',
  blankZh:'澳大利亚的公司必须在___注册，这是全国性的公司监管机构。',
  accepts:['ASIC','asic'],
  okEn:'Correct. ASIC (Australian Securities and Investments Commission) registers and regulates companies under the Corporations Act 2001.',
  okZh:'正确。ASIC（澳大利亚证券和投资委员会）依据《2001年公司法》注册和监管公司。',
  errEn:'The answer is ASIC — Australian Securities and Investments Commission, the national corporate regulator.',
  errZh:'答案是ASIC——澳大利亚证券和投资委员会，全国性公司监管机构。'},

{ id:'u3q4', unit:3, type:'mcq', topic:'Partnership Liability',
  en:'In a general partnership, the partners are liable for business debts:',
  zh:'在普通合伙中，合伙人对商业债务的责任是：',
  opts:['Only to the value of their capital contribution','With limited liability up to $500,000','Jointly and severally with unlimited liability','With limited liability protected by the Partnership Act'],
  optsZh:['仅限于其资本出资额','有限责任至50万元','连带且无限责任','受《合伙法》保护的有限责任'],
  ans:2,
  okEn:'Correct. General partners are jointly and severally liable — creditors can sue all partners together or any one partner for the full debt.',
  okZh:'正确。普通合伙人承担连带责任——债权人可以同时起诉所有合伙人，或单独起诉任一合伙人追偿全部债务。',
  errEn:'Incorrect. General partners have joint and several unlimited liability for all partnership debts.',
  errZh:'不正确。普通合伙人对所有合伙债务承担连带无限责任。'},

{ id:'u3q5', unit:3, type:'mcq', topic:'Corporations Act',
  en:'Which legislation primarily governs companies in Australia?',
  zh:'哪部法律主要管辖澳大利亚的公司？',
  opts:['Partnership Act 1963 (ACT)','Corporations Act 2001 (Cth)','Trade Practices Act 1974','ASIC Act 2001'],
  optsZh:['1963年《合伙法》（首都领地）','2001年《公司法》（联邦）','1974年《贸易行为法》','2001年《ASIC法》'],
  ans:1,
  okEn:'Correct. The Corporations Act 2001 (Cth) is the principal legislation governing all corporations in Australia.',
  okZh:'正确。《2001年公司法》（联邦）是管辖澳大利亚所有公司的主要立法。',
  errEn:'Incorrect. The Corporations Act 2001 (Cth) is the main legislation governing Australian companies.',
  errZh:'不正确。《2001年公司法》（联邦）是管辖澳大利亚公司的主要立法。'},

{ id:'u3q6', unit:3, type:'tf', topic:'Trusts',
  stmt:'A trust is a separate legal entity like a company.',
  stmtZh:'信托是像公司一样的独立法律实体。',
  ans:false,
  okEn:'Correct — FALSE. A trust is a legal relationship (not a legal entity). The trustee holds property on behalf of beneficiaries.',
  okZh:'正确——假。信托是一种法律关系（而非法律实体）。受托人代表受益人持有财产。',
  errEn:'FALSE. A trust is a legal relationship, not a separate legal entity. The trustee holds the property for beneficiaries.',
  errZh:'假。信托是一种法律关系，不是独立的法律实体。受托人为受益人持有财产。'},

// ── UNIT 4 ──────────────────────────────────────────────────
{ id:'u4q1', unit:4, type:'mcq', topic:'Elements of Contract',
  en:'Which of the following is NOT one of the 6 essential elements of a valid contract?',
  zh:'下列哪项不是有效合同的6个基本要素之一？',
  opts:['Offer','Consideration','Registration with a government body','Intention to create legal relations'],
  optsZh:['要约','对价','向政府机构注册','创立法律关系的意图'],
  ans:2,
  okEn:'Correct. The 6 elements are: offer, acceptance, consideration, intention, capacity, and legality. Registration is not required.',
  okZh:'正确。6个要素是：要约、承诺、对价、意图、行为能力和合法性。无需注册。',
  errEn:'Incorrect. The 6 elements are offer, acceptance, consideration, intention, capacity, and legality.',
  errZh:'不正确。6个要素是要约、承诺、对价、意图、行为能力和合法性。'},

{ id:'u4q2', unit:4, type:'mcq', topic:'Invitation to Treat',
  en:'In Pharmaceutical Society v Boots Cash Chemists (1953), goods displayed on a shop shelf are:',
  zh:'在Pharmaceutical Society v Boots（1953年）案中，陈列在商店货架上的商品是：',
  opts:['An offer to sell which customers can accept','An invitation to treat, not a binding offer','A completed contract at point of display','A unilateral contract open to all customers'],
  optsZh:['顾客可以接受的销售要约','要约邀请，而非具有约束力的要约','陈列时即完成的合同','对所有顾客开放的单方合同'],
  ans:1,
  okEn:'Correct. Displaying goods is an invitation to treat — the customer makes the offer at the checkout, which the shop accepts or rejects.',
  okZh:'正确。陈列商品是要约邀请——顾客在收银台发出要约，由商店接受或拒绝。',
  errEn:'Incorrect. Displaying goods is an invitation to treat, not an offer. The customer makes the offer at the till.',
  errZh:'不正确。陈列商品是要约邀请，而非要约。顾客在收银台发出要约。'},

{ id:'u4q3', unit:4, type:'mcq', topic:'Consideration',
  en:'Which statement about consideration is CORRECT?',
  zh:'关于对价，哪项陈述是正确的？',
  opts:['Consideration must be adequate and sufficient','Past consideration is valid consideration','Consideration must be sufficient but need not be adequate','Consideration can be a promise to perform an existing public duty'],
  optsZh:['对价必须充分且足够','过去的对价是有效对价','对价必须足够但不需要充分','对价可以是履行现有公共职责的承诺'],
  ans:2,
  okEn:'Correct. Consideration must be sufficient (real/genuine) but need not be adequate (equal in value). Courts do not assess commercial adequacy.',
  okZh:'正确。对价必须足够（真实/genuine），但不需要充分（等值）。法院不评估商业充分性。',
  errEn:'Incorrect. Consideration must be sufficient (genuine) but need not be adequate (equal in value).',
  errZh:'不正确。对价必须足够（真实），但不需要充分（等值）。'},

{ id:'u4q4', unit:4, type:'tf', topic:'Past Consideration',
  stmt:'Past consideration is valid consideration for a new contract.',
  stmtZh:'过去的对价是新合同的有效对价。',
  ans:false,
  okEn:'Correct — FALSE. "Past consideration is no consideration" — an act already done before the promise was made cannot be used as consideration.',
  okZh:'正确——假。"过去的对价不是对价"——在承诺作出之前已完成的行为不能作为对价。',
  errEn:'FALSE. Past consideration is no consideration — the act must occur after the promise to be valid consideration.',
  errZh:'假。过去的对价不是对价——行为必须在承诺之后发生才能成为有效对价。'},

{ id:'u4q5', unit:4, type:'mcq', topic:'Capacity',
  en:'Which group generally lacks full contractual capacity under Australian law?',
  zh:'根据澳大利亚法律，哪个群体通常缺乏完全合同行为能力？',
  opts:['Employed adults','Company directors','Minors (persons under 18)','Foreign nationals'],
  optsZh:['在职成年人','公司董事','未成年人（18岁以下）','外国国民'],
  ans:2,
  okEn:'Correct. Minors (under 18) generally lack full contractual capacity — contracts with minors are voidable at the minor\'s option, with limited exceptions (necessaries).',
  okZh:'正确。未成年人（18岁以下）通常缺乏完全合同行为能力——与未成年人的合同是可撤销的（有限例外，如生活必需品）。',
  errEn:'Incorrect. Minors (under 18) generally lack full contractual capacity under Australian law.',
  errZh:'不正确。根据澳大利亚法律，未成年人（18岁以下）通常缺乏完全合同行为能力。'},

{ id:'u4q6', unit:4, type:'scenario', topic:'Offer and Acceptance',
  scenario:'Ahmed sees a poster at the local council: "REWARD: $500 for information leading to recovery of stolen public artwork." Ahmed finds the artwork and returns it, then claims the reward.',
  scenarioZh:'艾哈迈德在当地市政厅看到一张海报："奖励：提供找回被盗公共艺术品线索者奖励500美元。"艾哈迈德找到了艺术品并归还，然后索取奖励。',
  en:'Can Ahmed successfully claim the $500 reward?',
  zh:'艾哈迈德能成功索取500美元的奖励吗？',
  opts:['No — he needed to sign a contract first','No — a poster is only an invitation to treat','Yes — finding and returning the artwork constitutes acceptance by performance','No — the reward expired when he returned it'],
  optsZh:['不能——他需要先签署合同','不能——海报只是要约邀请','能——找到并归还艺术品构成以行为方式承诺','不能——他归还时奖励已过期'],
  ans:2,
  okEn:'Correct. The poster is a unilateral offer — it can be accepted by performing the requested act. Ahmed accepted by finding and returning the artwork.',
  okZh:'正确。海报是单方要约——可以通过履行所要求的行为来承诺。艾哈迈德通过找到并归还艺术品完成了承诺。',
  errEn:'Incorrect. The poster is a unilateral offer accepted by performance. Ahmed can claim the reward.',
  errZh:'不正确。海报是以行为方式承诺的单方要约。艾哈迈德可以索取奖励。'},

// ── UNIT 5 ──────────────────────────────────────────────────
{ id:'u5q1', unit:5, type:'mcq', topic:'Conditions vs Warranties',
  en:'In contract law, a "condition" is:',
  zh:'在合同法中，"条件"是：',
  opts:['Any term in a standard form contract','A fundamental term — breach allows termination and damages','A minor term — breach allows damages only','A term implied by statute only'],
  optsZh:['标准格式合同中的任何条款','基本条款——违反允许终止合同并索赔损害','次要条款——违反只能索赔损害','仅由法规隐含的条款'],
  ans:1,
  okEn:'Correct. A condition is a fundamental term — breach entitles the innocent party to terminate the contract AND claim damages.',
  okZh:'正确。条件是基本条款——违反使无辜方有权终止合同并索赔损害。',
  errEn:'Incorrect. A condition is a fundamental term; breach gives the right to terminate and claim damages.',
  errZh:'不正确。条件是基本条款；违反给予终止合同并索赔损害的权利。'},

{ id:'u5q2', unit:5, type:'mcq', topic:'Hadley v Baxendale',
  en:'The rule in Hadley v Baxendale (1854) concerns which aspect of contract remedies?',
  zh:'Hadley v Baxendale（1854年）的规则涉及合同救济的哪个方面？',
  opts:['The duty to mitigate loss','Remoteness of damages — only foreseeable losses are recoverable','Specific performance requirements','Frustration of contract'],
  optsZh:['减损损失的义务','损害赔偿的远程性——只有可预见的损失才可追偿','特定履行要求','合同受阻'],
  ans:1,
  okEn:'Correct. Hadley v Baxendale limits recoverable damages to losses that arise naturally from the breach or were reasonably in the contemplation of both parties.',
  okZh:'正确。Hadley v Baxendale将可追偿损害限制为自然因违约而产生的损失，或双方合理预期的损失。',
  errEn:'Incorrect. Hadley v Baxendale establishes the remoteness rule — only reasonably foreseeable losses are recoverable.',
  errZh:'不正确。Hadley v Baxendale确立了远程性规则——只有合理可预见的损失才可追偿。'},

{ id:'u5q3', unit:5, type:'mcq', topic:'Frustration',
  en:'A contract is "frustrated" when:',
  zh:'合同"受阻"是指：',
  opts:['One party refuses to perform','An unexpected event makes performance impossible or radically different from what was agreed','The consideration is inadequate','One party commits a minor breach'],
  optsZh:['一方拒绝履行','意外事件使履行不可能或与约定根本不同','对价不充分','一方构成轻微违约'],
  ans:1,
  okEn:'Correct. Frustration occurs when an unforeseen event, through no fault of either party, makes contractual performance impossible or radically different.',
  okZh:'正确。当不可预见的事件（双方均无过错）使合同履行不可能或根本性改变时，发生合同受阻。',
  errEn:'Incorrect. Frustration occurs when an unforeseen event makes performance impossible or radically different — not mere inconvenience.',
  errZh:'不正确。合同受阻是指不可预见的事件使履行不可能或根本性改变——而非单纯的不便。'},

{ id:'u5q4', unit:5, type:'mcq', topic:'Vitiating Factors',
  en:'Which of the following is NOT a vitiating factor that can make a contract voidable?',
  zh:'下列哪项不是可使合同可撤销的缺陷因素？',
  opts:['Misrepresentation','Duress','Inconvenience to one party','Undue influence'],
  optsZh:['虚假陈述','胁迫','对一方的不便','不当影响'],
  ans:2,
  okEn:'Correct. "Inconvenience" is not a vitiating factor. The main vitiating factors are misrepresentation, duress, undue influence, unconscionability, and mistake.',
  okZh:'正确。"不便"不是缺陷因素。主要缺陷因素是虚假陈述、胁迫、不当影响、违反良知和错误。',
  errEn:'Incorrect. Inconvenience is not a vitiating factor. The factors include misrepresentation, duress, undue influence, unconscionability.',
  errZh:'不正确。不便不是缺陷因素。因素包括虚假陈述、胁迫、不当影响、违反良知。'},

{ id:'u5q5', unit:5, type:'tf', topic:'Liquidated Damages',
  stmt:'Liquidated damages are damages assessed by a court after a breach occurs.',
  stmtZh:'违约金是在违约发生后由法院评估的损害赔偿。',
  ans:false,
  okEn:'Correct — FALSE. Liquidated damages are a genuine pre-estimate of loss agreed by the parties in advance and written into the contract.',
  okZh:'正确——假。违约金是双方事先约定并写入合同的对损失的真实预估。',
  errEn:'FALSE. Liquidated damages are a pre-agreed genuine estimate of loss specified in the contract itself — not assessed by a court.',
  errZh:'假。违约金是合同中规定的预先约定的损失真实估计——而非由法院评估。'},

{ id:'u5q6', unit:5, type:'mcq', topic:'Remedies',
  en:'Which remedy for breach of contract ORDERS a party to perform their contractual obligations?',
  zh:'合同违约的哪种救济要求当事方履行其合同义务？',
  opts:['Damages','Rescission','Specific performance','Injunction'],
  optsZh:['损害赔偿','撤销','特定履行','禁令'],
  ans:2,
  okEn:'Correct. Specific performance is an equitable remedy ordering the defendant to perform their contractual obligations (typically used for unique goods or land).',
  okZh:'正确。特定履行是一种衡平救济，要求被告履行其合同义务（通常用于独特商品或土地）。',
  errEn:'Incorrect. Specific performance orders a party to actually perform their contractual obligations.',
  errZh:'不正确。特定履行要求当事方实际履行其合同义务。'},

// ── UNIT 6 ──────────────────────────────────────────────────
{ id:'u6q1', unit:6, type:'mcq', topic:'Donoghue v Stevenson',
  en:'The "neighbour principle" in negligence law was established in which case?',
  zh:'过失法中的"邻居原则"是在哪个案例中确立的？',
  opts:['Hadley v Baxendale (1854)','Hedley Byrne v Heller (1964)','Donoghue v Stevenson [1932]','Wagon Mound (No 1) [1961]'],
  optsZh:['Hadley v Baxendale（1854年）','Hedley Byrne v Heller（1964年）','Donoghue v Stevenson（1932年）','Wagon Mound（第1号）（1961年）'],
  ans:2,
  okEn:'Correct. In Donoghue v Stevenson [1932], Lord Atkin established the neighbour principle: you owe a duty of care to those reasonably affected by your acts.',
  okZh:'正确。在Donoghue v Stevenson（1932年）案中，阿特金勋爵确立了邻居原则：你对那些合理受你行为影响的人负有注意义务。',
  errEn:'Incorrect. Donoghue v Stevenson [1932] established the neighbour principle and the modern law of negligence.',
  errZh:'不正确。Donoghue v Stevenson（1932年）确立了邻居原则和现代过失法。'},

{ id:'u6q2', unit:6, type:'mcq', topic:'Elements of Negligence',
  en:'To succeed in a negligence claim, a plaintiff must prove which four elements?',
  zh:'要在过失索赔中胜诉，原告必须证明哪四个要素？',
  opts:['Offer, acceptance, consideration, intention','Duty of care, breach, causation, damage','Misrepresentation, duress, undue influence, mistake','Proximity, foreseeability, policy, fairness'],
  optsZh:['要约、承诺、对价、意图','注意义务、违反、因果关系、损害','虚假陈述、胁迫、不当影响、错误','邻近性、可预见性、政策、公平性'],
  ans:1,
  okEn:'Correct. The four elements of negligence are: (1) duty of care, (2) breach of that duty, (3) causation, and (4) damage (not too remote).',
  okZh:'正确。过失的四个要素是：（1）注意义务，（2）违反该义务，（3）因果关系，（4）损害（非过于远程）。',
  errEn:'Incorrect. The four elements are duty of care, breach, causation, and damage.',
  errZh:'不正确。四个要素是注意义务、违反、因果关系和损害。'},

{ id:'u6q3', unit:6, type:'mcq', topic:'Causation — But For Test',
  en:'The "but for" test in negligence is used to establish:',
  zh:'过失中的"若非"测试用于确定：',
  opts:['Remoteness of damage','Whether the defendant owed a duty of care','Causation — whether the defendant\'s breach caused the plaintiff\'s harm','Whether the defendant acted reasonably'],
  optsZh:['损害的远程性','被告是否负有注意义务','因果关系——被告的违反是否导致原告的伤害','被告是否合理行事'],
  ans:2,
  okEn:'Correct. The but-for test asks: "But for the defendant\'s negligence, would the plaintiff have suffered the harm?" If yes, causation is established.',
  okZh:'正确。若非测试问："若非被告的过失，原告是否会遭受伤害？"如果是，则确立因果关系。',
  errEn:'Incorrect. The but-for test establishes causation: but for the defendant\'s breach, would the harm have occurred?',
  errZh:'不正确。若非测试确立因果关系：若非被告的违反，损害是否会发生？'},

{ id:'u6q4', unit:6, type:'mcq', topic:'Breach — Reasonable Person',
  en:'The standard used to determine whether a defendant breached their duty of care is:',
  zh:'用于确定被告是否违反其注意义务的标准是：',
  opts:['The subjective standard of the particular defendant','The standard of the "reasonable person" in the same circumstances','The expert professional standard in all cases','The highest possible standard of care'],
  optsZh:['特定被告的主观标准','相同情况下"理性人"的标准','所有情况下的专家专业标准','最高可能的注意标准'],
  ans:1,
  okEn:'Correct. The objective "reasonable person" standard (Blyth v Birmingham Waterworks) — what would a reasonable person in the defendant\'s position have done?',
  okZh:'正确。客观的"理性人"标准（Blyth v Birmingham Waterworks）——处于被告地位的理性人会怎么做？',
  errEn:'Incorrect. The objective reasonable person standard is used — what would a reasonable person in those circumstances have done?',
  errZh:'不正确。使用客观理性人标准——处于该情况的理性人会怎么做？'},

{ id:'u6q5', unit:6, type:'scenario', topic:'Breach of Duty',
  scenario:'Dr. Chen, a cardiologist, performs a routine heart stent procedure. She uses an outdated technique that peer-reviewed guidelines replaced 3 years ago. The patient suffers preventable complications.',
  scenarioZh:'陈博士是一名心脏科医生，她进行了一次常规心脏支架手术。她使用了一种3年前经同行评审指南取代的过时技术。患者遭受了可预防的并发症。',
  en:'In a negligence claim, has Dr. Chen breached her duty of care?',
  zh:'在过失索赔中，陈博士是否违反了其注意义务？',
  opts:['No — she performed the operation competently','No — any complications are an inherent surgical risk','Yes — she fell below the standard of a reasonably competent cardiologist','Yes — only because the patient did not consent to the old technique'],
  optsZh:['否——她胜任地进行了手术','否——任何并发症都是手术固有风险','是——她低于合理胜任的心脏科医生标准','是——仅因为患者未同意使用旧技术'],
  ans:2,
  okEn:'Correct. A professional is measured against the standard of a reasonably competent member of their profession. Using an outdated technique falls below that standard.',
  okZh:'正确。专业人员按照其专业中合理胜任成员的标准进行衡量。使用过时技术低于该标准。',
  errEn:'Incorrect. Dr. Chen breached her duty by using a technique below the standard expected of a reasonably competent cardiologist.',
  errZh:'不正确。陈博士使用低于合理胜任心脏科医生预期标准的技术，违反了其注意义务。'},

{ id:'u6q6', unit:6, type:'mcq', topic:'Remoteness — Wagon Mound',
  en:'The Wagon Mound (No 1) [1961] test for remoteness of damage asks whether:',
  zh:'Wagon Mound（第1号）（1961年）关于损害远程性的测试问：',
  opts:['The damage was the direct result of the breach','The damage was reasonably foreseeable by the defendant','The defendant intended to cause the damage','The damage occurred within 6 months of the breach'],
  optsZh:['损害是违反的直接结果','被告合理预见了损害','被告意图造成损害','损害在违反后6个月内发生'],
  ans:1,
  okEn:'Correct. The Wagon Mound test: a defendant is only liable for damage that was reasonably foreseeable — not for unforeseeable consequences.',
  okZh:'正确。Wagon Mound测试：被告只对合理可预见的损害承担责任——不对不可预见的后果负责。',
  errEn:'Incorrect. The Wagon Mound test requires damage to be reasonably foreseeable by the defendant to be recoverable.',
  errZh:'不正确。Wagon Mound测试要求损害对被告合理可预见才可追偿。'},

// ── UNIT 7 ──────────────────────────────────────────────────
{ id:'u7q1', unit:7, type:'mcq', topic:'Negligent Misstatement',
  en:'Hedley Byrne v Heller [1964] established liability for:',
  zh:'Hedley Byrne v Heller（1964年）确立了以下责任：',
  opts:['Physical harm caused by defective products','Negligent misstatement causing pure economic loss','Trespass to land','Breach of statutory duty'],
  optsZh:['缺陷产品造成的人身伤害','导致纯粹经济损失的疏忽失实陈述','土地侵犯','违反法定义务'],
  ans:1,
  okEn:'Correct. Hedley Byrne v Heller established that liability can arise for a negligent misstatement (advice/information) that causes pure economic loss, where a special relationship exists.',
  okZh:'正确。Hedley Byrne v Heller确立了，当存在特殊关系时，导致纯粹经济损失的疏忽失实陈述（建议/信息）可以产生责任。',
  errEn:'Incorrect. Hedley Byrne v Heller established liability for negligent misstatement causing pure economic loss.',
  errZh:'不正确。Hedley Byrne v Heller确立了疏忽失实陈述导致纯粹经济损失的责任。'},

{ id:'u7q2', unit:7, type:'mcq', topic:'Special Relationship',
  en:'For a negligent misstatement claim, what must exist between the parties?',
  zh:'对于疏忽失实陈述索赔，当事方之间必须存在什么？',
  opts:['A written contract','A special relationship of skill, reliance, and knowledge','A fiduciary relationship only','A formal retainer agreement'],
  optsZh:['书面合同','技能、依赖和知识的特殊关系','仅限信托关系','正式委托协议'],
  ans:1,
  okEn:'Correct. There must be a "special relationship" — the defendant has special skill, the plaintiff reasonably relied on the advice, and the defendant knew of that reliance.',
  okZh:'正确。必须存在"特殊关系"——被告具有特殊技能，原告合理依赖了建议，被告知道这种依赖。',
  errEn:'Incorrect. A special relationship requiring skill, reasonable reliance, and knowledge of that reliance must exist.',
  errZh:'不正确。必须存在需要技能、合理依赖和知道该依赖的特殊关系。'},

{ id:'u7q3', unit:7, type:'mcq', topic:'Defences to Negligence',
  en:'"Volenti non fit injuria" means:',
  zh:'"自愿承担风险"意味着：',
  opts:['The defendant acted voluntarily in creating the risk','A person who freely consents to a risk cannot later sue for resulting harm','Contributory negligence bars all recovery','The plaintiff was also negligent'],
  optsZh:['被告自愿创造了风险','自愿同意承担风险的人不能因此后来起诉损害','相互过失阻止一切追偿','原告也存在过失'],
  ans:1,
  okEn:'Correct. Volenti non fit injuria — "no injury is done to one who consents." If the plaintiff freely and voluntarily assumed the risk, the defendant has a complete defence.',
  okZh:'正确。自愿承担风险——"同意者不受伤害"。如果原告自由自愿地承担了风险，被告有完全抗辩。',
  errEn:'Incorrect. Volenti non fit injuria means a person who voluntarily accepts a known risk cannot sue for resulting harm.',
  errZh:'不正确。自愿承担风险意味着自愿接受已知风险的人不能为此起诉损害。'},

{ id:'u7q4', unit:7, type:'tf', topic:'Proportionate Liability',
  stmt:'Proportionate liability allows a court to apportion damages among multiple defendants according to their respective responsibility.',
  stmtZh:'按比例责任允许法院根据各方各自的责任在多名被告之间分配损害赔偿。',
  ans:true,
  okEn:'Correct — TRUE. Under proportionate liability schemes (e.g., Civil Liability Acts), where multiple parties caused the same loss, each pays only their proportionate share.',
  okZh:'正确——真。在按比例责任方案（如《民事责任法》）下，当多方造成相同损失时，每方只支付其相应份额。',
  errEn:'TRUE. Proportionate liability divides responsibility among multiple defendants based on their respective contribution to the loss.',
  errZh:'真。按比例责任根据各被告对损失的相应贡献在多名被告之间划分责任。'},

{ id:'u7q5', unit:7, type:'mcq', topic:'Pure Economic Loss',
  en:'"Pure economic loss" in tort law refers to:',
  zh:'侵权法中的"纯粹经济损失"是指：',
  opts:['Loss of profits caused by a physical injury','Financial loss not resulting from personal injury or property damage','Loss of reputation due to defamation','Emotional distress without financial consequence'],
  optsZh:['人身伤害造成的利润损失','非人身伤害或财产损害导致的财务损失','诽谤造成的声誉损失','没有财务后果的情绪困扰'],
  ans:1,
  okEn:'Correct. Pure economic loss is financial loss that does not flow from any physical harm to the plaintiff\'s person or property — courts have traditionally been cautious about allowing such claims.',
  okZh:'正确。纯粹经济损失是不来自原告人身或财产任何物理伤害的财务损失——法院历来对允许此类索赔持谨慎态度。',
  errEn:'Incorrect. Pure economic loss is financial loss that is not linked to physical injury or property damage.',
  errZh:'不正确。纯粹经济损失是与人身伤害或财产损害无关的财务损失。'},

// ── UNIT 8 ──────────────────────────────────────────────────
{ id:'u8q1', unit:8, type:'mcq', topic:'Australian Consumer Law',
  en:'The Australian Consumer Law (ACL) is contained in Schedule 2 of which Act?',
  zh:'《澳大利亚消费者法》（ACL）包含在哪部法令的附表2中？',
  opts:['ASIC Act 2001','Trade Practices Act 1974','Competition and Consumer Act 2010','Corporations Act 2001'],
  optsZh:['2001年《ASIC法》','1974年《贸易行为法》','2010年《竞争与消费者法》','2001年《公司法》'],
  ans:2,
  okEn:'Correct. The ACL is Schedule 2 of the Competition and Consumer Act 2010 (Cth) — it applies nationally to all consumer transactions.',
  okZh:'正确。ACL是《2010年竞争与消费者法》（联邦）的附表2——适用于所有消费者交易。',
  errEn:'Incorrect. The ACL is Schedule 2 of the Competition and Consumer Act 2010 (Cth).',
  errZh:'不正确。ACL是《2010年竞争与消费者法》（联邦）的附表2。'},

{ id:'u8q2', unit:8, type:'mcq', topic:'Misleading Conduct',
  en:'Section 18 of the ACL prohibits:',
  zh:'ACL第18条禁止：',
  opts:['Unfair contract terms','Misleading or deceptive conduct in trade or commerce','Consumer guarantees breaches','Unconscionable conduct only'],
  optsZh:['不公平合同条款','贸易或商业中的误导性或欺骗性行为','违反消费者保证','仅违反良知的行为'],
  ans:1,
  okEn:'Correct. Section 18 ACL: "A person must not, in trade or commerce, engage in conduct that is misleading or deceptive or is likely to mislead or deceive."',
  okZh:'正确。ACL第18条："在贸易或商业中，任何人不得从事误导性或欺骗性行为，或可能误导或欺骗的行为。"',
  errEn:'Incorrect. Section 18 ACL prohibits misleading or deceptive conduct in trade or commerce.',
  errZh:'不正确。ACL第18条禁止贸易或商业中的误导性或欺骗性行为。'},

{ id:'u8q3', unit:8, type:'mcq', topic:'Consumer Guarantees',
  en:'Under the ACL consumer guarantees, goods must be of "acceptable quality." This means they are:',
  zh:'根据ACL消费者保证，商品必须具有"可接受质量"。这意味着它们：',
  opts:['The cheapest available on the market','Safe, durable, free from defects, acceptable in appearance, and fit for all purposes','Exactly as described in any advertisement','Covered by a manufacturer\'s warranty'],
  optsZh:['市场上最便宜的','安全、耐用、无缺陷、外观可接受、适合所有用途','完全符合任何广告描述','有制造商保修'],
  ans:1,
  okEn:'Correct. Under s54 ACL, acceptable quality means the goods are safe, durable, free from defects, acceptable in appearance, and fit for all purposes for which goods of that kind are commonly supplied.',
  okZh:'正确。根据ACL第54条，可接受质量意味着商品安全、耐用、无缺陷、外观可接受，且适合该类商品通常供应的所有用途。',
  errEn:'Incorrect. "Acceptable quality" under s54 ACL means safe, durable, free from defects, acceptable in appearance, and fit for purpose.',
  errZh:'不正确。ACL第54条下的"可接受质量"意味着安全、耐用、无缺陷、外观可接受和适合用途。'},

{ id:'u8q4', unit:8, type:'fill', topic:'ACCC',
  blank:'The body that enforces the Australian Consumer Law at the national level is the ___.',
  blankZh:'在国家层面执行《澳大利亚消费者法》的机构是___。',
  accepts:['ACCC','accc','Australian Competition and Consumer Commission'],
  okEn:'Correct. The ACCC (Australian Competition and Consumer Commission) is the national regulator enforcing the ACL and competition laws.',
  okZh:'正确。ACCC（澳大利亚竞争与消费者委员会）是执行ACL和竞争法的国家监管机构。',
  errEn:'The answer is ACCC — Australian Competition and Consumer Commission, the national consumer law regulator.',
  errZh:'答案是ACCC——澳大利亚竞争与消费者委员会，国家消费者法监管机构。'},

{ id:'u8q5', unit:8, type:'mcq', topic:'Unfair Contract Terms',
  en:'Under s23 ACL, an unfair contract term in a standard form consumer contract is one that:',
  zh:'根据ACL第23条，标准格式消费者合同中的不公平合同条款是：',
  opts:['Is written in complex legal language','Creates a significant imbalance, is not reasonably necessary, and would cause financial or other detriment','Is longer than 5 pages','Requires arbitration of disputes'],
  optsZh:['使用复杂法律语言','造成显著不平衡、非合理必要、会造成财务或其他损害','超过5页','要求仲裁争议'],
  ans:1,
  okEn:'Correct. Under s23 ACL, an unfair term causes significant imbalance, is not reasonably necessary to protect the supplier\'s legitimate interests, and would cause detriment if relied upon.',
  okZh:'正确。根据ACL第23条，不公平条款造成显著不平衡、非合理必要以保护供应商合法利益、如被依赖会造成损害。',
  errEn:'Incorrect. An unfair term under s23 creates significant imbalance, is not reasonably necessary, and causes detriment.',
  errZh:'不正确。第23条下的不公平条款造成显著不平衡、非合理必要并造成损害。'},

{ id:'u8q6', unit:8, type:'tf', topic:'Consumer Remedies',
  stmt:'Under ACL consumer guarantees, a supplier must always offer a full refund for any faulty product.',
  stmtZh:'根据ACL消费者保证，供应商必须始终为任何有缺陷的产品提供全额退款。',
  ans:false,
  okEn:'Correct — FALSE. The remedy depends on the seriousness of the failure. Major failures entitle consumers to a refund, replacement, or compensation. Minor failures only require repair.',
  okZh:'正确——假。救济取决于故障的严重性。重大故障使消费者有权获得退款、更换或赔偿。轻微故障只需要修复。',
  errEn:'FALSE. Remedy depends on failure severity — major failures allow refund/replacement; minor failures only require repair.',
  errZh:'假。救济取决于故障严重性——重大故障允许退款/更换；轻微故障只需要修复。'},

// ── UNIT 9 ──────────────────────────────────────────────────
{ id:'u9q1', unit:9, type:'fill', topic:'ESG',
  blank:'ESG stands for Environmental, Social, and ___.',
  blankZh:'ESG代表环境、社会和___。',
  accepts:['Governance','governance'],
  okEn:'Correct. ESG = Environmental, Social, Governance — the three pillars used to measure a company\'s sustainability and ethical impact.',
  okZh:'正确。ESG=环境、社会、治理——用于衡量公司可持续性和道德影响的三个支柱。',
  errEn:'The answer is "Governance" — ESG: Environmental, Social, Governance.',
  errZh:'答案是"治理"——ESG：环境、社会、治理。'},

{ id:'u9q2', unit:9, type:'mcq', topic:"Carroll's CSR Pyramid",
  en:"Carroll's Pyramid of Corporate Social Responsibility (CSR) has four levels. What is the BASE (most fundamental) level?",
  zh:"卡罗尔的企业社会责任（CSR）金字塔有四个层次。什么是最基础（最基本）的层次？",
  opts:['Philanthropic responsibilities','Ethical responsibilities','Legal responsibilities','Economic responsibilities'],
  optsZh:['慈善责任','道德责任','法律责任','经济责任'],
  ans:3,
  okEn:"Correct. Carroll's Pyramid (from base to top): Economic → Legal → Ethical → Philanthropic. Economic is the foundation — businesses must be profitable to survive.",
  okZh:"正确。卡罗尔金字塔（从底部到顶部）：经济→法律→道德→慈善。经济是基础——企业必须盈利才能生存。",
  errEn:"Incorrect. The base of Carroll's Pyramid is economic responsibilities — businesses must be profitable.",
  errZh:"不正确。卡罗尔金字塔的基础是经济责任——企业必须盈利。"},

{ id:'u9q3', unit:9, type:'mcq', topic:'Triple Bottom Line',
  en:'The "Triple Bottom Line" (TBL) framework measures corporate performance in terms of:',
  zh:'"三重底线"（TBL）框架以什么来衡量企业绩效：',
  opts:['Revenue, costs, and profit','People, Planet, Profit','Quality, Safety, Environment','Shareholders, Stakeholders, Society'],
  optsZh:['收入、成本和利润','人、地球、利润','质量、安全、环境','股东、利益相关者、社会'],
  ans:1,
  okEn:'Correct. The TBL (Elkington, 1994) measures social (People), environmental (Planet), and financial (Profit) performance.',
  okZh:'正确。三重底线（Elkington，1994年）衡量社会（人）、环境（地球）和财务（利润）绩效。',
  errEn:'Incorrect. The Triple Bottom Line measures People (social), Planet (environmental), and Profit (financial).',
  errZh:'不正确。三重底线衡量人（社会）、地球（环境）和利润（财务）。'},

{ id:'u9q4', unit:9, type:'mcq', topic:'Stakeholder Theory',
  en:'Stakeholder Theory, developed by R. Edward Freeman, argues that businesses should create value for:',
  zh:'由R.爱德华·弗里曼提出的利益相关者理论认为，企业应该为以下对象创造价值：',
  opts:['Shareholders only','Shareholders and bondholders only','All stakeholders who affect or are affected by the company','Only employees and customers'],
  optsZh:['仅股东','仅股东和债券持有人','影响公司或受公司影响的所有利益相关者','仅员工和客户'],
  ans:2,
  okEn:'Correct. Freeman\'s Stakeholder Theory holds that companies have responsibilities to all stakeholders — shareholders, employees, suppliers, customers, communities, and the environment.',
  okZh:'正确。弗里曼的利益相关者理论认为，公司对所有利益相关者负有责任——股东、员工、供应商、客户、社区和环境。',
  errEn:'Incorrect. Stakeholder Theory holds businesses are responsible to all parties who affect or are affected by them.',
  errZh:'不正确。利益相关者理论认为企业对影响他们或受他们影响的所有方负有责任。'},

{ id:'u9q5', unit:9, type:'mcq', topic:'UN SDGs',
  en:'The United Nations Sustainable Development Goals (SDGs) were adopted as part of the 2030 Agenda in which year?',
  zh:'联合国可持续发展目标（SDGs）作为2030年议程的一部分，是在哪年通过的？',
  opts:['2000','2010','2015','2020'],
  optsZh:['2000年','2010年','2015年','2020年'],
  ans:2,
  okEn:'Correct. The 17 SDGs were adopted by all UN member states in 2015 as the "2030 Agenda for Sustainable Development."',
  okZh:'正确。17个可持续发展目标于2015年由所有联合国成员国通过，作为"2030年可持续发展议程"。',
  errEn:'Incorrect. The 17 SDGs were adopted by UN member states in 2015.',
  errZh:'不正确。17个可持续发展目标于2015年由联合国成员国通过。'},

{ id:'u9q6', unit:9, type:'tf', topic:'Greenwashing',
  stmt:'Greenwashing involves making false or misleading environmental claims about a company\'s products or practices.',
  stmtZh:'洗绿行为包括对公司产品或做法作出虚假或误导性的环境声明。',
  ans:true,
  okEn:'Correct — TRUE. Greenwashing is when companies make misleading or unsubstantiated claims about their environmental credentials — enforceable under s18 ACL by the ACCC.',
  okZh:'正确——真。洗绿是公司对其环境资质作出误导性或无根据声明的行为——ACCC可依据ACL第18条执行。',
  errEn:'TRUE. Greenwashing — false or misleading environmental claims — is enforceable under ACL s18 by the ACCC.',
  errZh:'真。洗绿——虚假或误导性环境声明——ACCC可依据ACL第18条执行。'},

// ── UNIT 10 ──────────────────────────────────────────────────
{ id:'u10q1', unit:10, type:'mcq', topic:'EPBC Act',
  en:'The EPBC Act 1999 stands for:',
  zh:'EPBC法案1999年代表：',
  opts:['Environmental Protection and Business Compliance Act','Environment Protection and Biodiversity Conservation Act','Ecological Planning and Building Code Act','Environmental Permit and Business Conduct Act'],
  optsZh:['环境保护和企业合规法','环境保护和生物多样性保护法','生态规划和建筑规范法','环境许可和企业行为法'],
  ans:1,
  okEn:'Correct. The Environment Protection and Biodiversity Conservation Act 1999 (Cth) is Australia\'s main national environmental law, protecting biodiversity and significant environmental matters.',
  okZh:'正确。《1999年环境保护和生物多样性保护法》（联邦）是澳大利亚主要的国家环境法，保护生物多样性和重要环境事项。',
  errEn:'Incorrect. EPBC = Environment Protection and Biodiversity Conservation Act 1999.',
  errZh:'不正确。EPBC = 1999年环境保护和生物多样性保护法。'},

{ id:'u10q2', unit:10, type:'mcq', topic:'Climate Change Act 2022',
  en:'Australia\'s Climate Change Act 2022 set a target to reduce greenhouse gas emissions by what percentage by 2030 (compared to 2005 levels)?',
  zh:'澳大利亚《2022年气候变化法》设定了到2030年（与2005年水平相比）减少温室气体排放的目标是多少？',
  opts:['26–28%','35%','43%','50%'],
  optsZh:['26-28%','35%','43%','50%'],
  ans:2,
  okEn:'Correct. The Climate Change Act 2022 enshrined a 43% reduction in emissions by 2030 (from 2005 levels) and net zero by 2050 into law.',
  okZh:'正确。《2022年气候变化法》将到2030年减排43%（与2005年水平相比）和到2050年净零排放写入法律。',
  errEn:'Incorrect. The Climate Change Act 2022 targets a 43% reduction in emissions by 2030 from 2005 levels.',
  errZh:'不正确。《2022年气候变化法》目标是到2030年从2005年水平减排43%。'},

{ id:'u10q3', unit:10, type:'mcq', topic:'Modern Slavery Act',
  en:'The Modern Slavery Act 2018 (Cth) requires Australian entities with annual consolidated revenue over ___ to report on modern slavery risks in their supply chains.',
  zh:'《2018年现代奴役法》（联邦）要求年合并收入超过___的澳大利亚实体报告其供应链中的现代奴役风险。',
  opts:['$10 million','$50 million','$100 million','$500 million'],
  optsZh:['1000万澳元','5000万澳元','1亿澳元','5亿澳元'],
  ans:2,
  okEn:'Correct. Entities with consolidated annual revenue of AU$100 million or more must submit an annual Modern Slavery Statement to the government.',
  okZh:'正确。年合并收入达1亿澳元或以上的实体必须向政府提交年度现代奴役声明。',
  errEn:'Incorrect. The threshold is $100 million annual consolidated revenue.',
  errZh:'不正确。门槛是年合并收入1亿澳元。'},

{ id:'u10q4', unit:10, type:'tf', topic:'Paris Agreement',
  stmt:'The Paris Agreement legally binds all signatory nations to achieve specific quantified greenhouse gas emission reductions.',
  stmtZh:'《巴黎协定》在法律上约束所有签署国实现特定量化的温室气体减排目标。',
  ans:false,
  okEn:'Correct — FALSE. While the Paris Agreement framework is legally binding, each country\'s Nationally Determined Contribution (NDC) is self-set and voluntary — there is no international enforcement mechanism.',
  okZh:'正确——假。虽然《巴黎协定》框架具有法律约束力，但每个国家的国家自主贡献（NDC）是自行设定的且是自愿的——没有国际执行机制。',
  errEn:'FALSE. The Paris Agreement framework is binding, but each country\'s specific emission targets (NDCs) are nationally determined and voluntary.',
  errZh:'假。《巴黎协定》框架具有约束力，但每个国家的具体减排目标（NDC）是国家自主确定且自愿的。'},

{ id:'u10q5', unit:10, type:'mcq', topic:'ASX Governance',
  en:'The ASX Corporate Governance Principles and Recommendations are published by:',
  zh:'ASX企业治理原则和建议由谁发布：',
  opts:['ASIC','APRA','ASX Corporate Governance Council','Australian Treasury'],
  optsZh:['ASIC','APRA','ASX企业治理委员会','澳大利亚财政部'],
  ans:2,
  okEn:'Correct. The ASX Corporate Governance Council (comprising ASX and 20+ investor and business groups) publishes the Principles and Recommendations used by listed entities.',
  okZh:'正确。ASX企业治理委员会（由ASX和20多个投资者和商业团体组成）发布上市实体使用的原则和建议。',
  errEn:'Incorrect. The ASX Corporate Governance Principles are published by the ASX Corporate Governance Council.',
  errZh:'不正确。ASX企业治理原则由ASX企业治理委员会发布。'},

{ id:'u10q6', unit:10, type:'mcq', topic:'Greenwashing Enforcement',
  en:'In Australia, greenwashing enforcement against misleading environmental claims is primarily carried out by:',
  zh:'在澳大利亚，针对误导性环境声明的洗绿执法主要由谁进行：',
  opts:['EPA (Environment Protection Authority)','APRA','ACCC','ASIC'],
  optsZh:['EPA（环境保护局）','APRA','ACCC','ASIC'],
  ans:2,
  okEn:'Correct. The ACCC enforces ACL s18 against misleading environmental claims. ASIC also takes action on misleading sustainability claims by financial entities.',
  okZh:'正确。ACCC依据ACL第18条针对误导性环境声明执法。ASIC也对金融实体的误导性可持续发展声明采取行动。',
  errEn:'Incorrect. The ACCC primarily enforces against greenwashing under ACL s18. ASIC may also act in financial services.',
  errZh:'不正确。ACCC主要依据ACL第18条针对洗绿行为执法。ASIC也可能在金融服务领域采取行动。'},

// ── UNIT 11 ──────────────────────────────────────────────────
{ id:'u11q1', unit:11, type:'mcq', topic:'Director Duties',
  en:'Section 180 of the Corporations Act 2001 requires directors to exercise their powers with:',
  zh:'《2001年公司法》第180条要求董事以以下方式行使其权力：',
  opts:['Maximum profit for shareholders at all times','The degree of care and diligence of a reasonable person in their position','Absolute caution avoiding all business risk','Strict compliance with all stakeholder wishes'],
  optsZh:['始终为股东最大化利润','处于其职位的理性人的谨慎和勤勉程度','绝对谨慎避免所有商业风险','严格遵守所有利益相关者的意愿'],
  ans:1,
  okEn:'Correct. Section 180 imposes an objective standard — the care and diligence of a reasonable person with the same responsibilities, informed about the company.',
  okZh:'正确。第180条施加客观标准——承担相同责任、了解公司的理性人的谨慎和勤勉程度。',
  errEn:'Incorrect. Section 180 requires the care and diligence of a reasonable person in the same position.',
  errZh:'不正确。第180条要求处于相同职位的理性人的谨慎和勤勉程度。'},

{ id:'u11q2', unit:11, type:'mcq', topic:'Director Duties',
  en:'Section 181 of the Corporations Act requires directors to act:',
  zh:'《公司法》第181条要求董事：',
  opts:['To maximise short-term shareholder returns','In good faith in the best interests of the corporation and for a proper purpose','Only in their own financial interests','To follow all instructions from majority shareholders'],
  optsZh:['最大化短期股东回报','善意地为了公司的最佳利益并出于正当目的行事','仅为自身财务利益','遵循所有多数股东的指示'],
  ans:1,
  okEn:'Correct. Section 181 imposes a duty of good faith — directors must act honestly in the best interests of the company as a whole, not personal gain.',
  okZh:'正确。第181条施加诚信义务——董事必须为了整个公司的最佳利益诚实行事，而非个人利益。',
  errEn:'Incorrect. Section 181 requires directors to act in good faith in the best interests of the corporation for a proper purpose.',
  errZh:'不正确。第181条要求董事善意地为了公司的最佳利益出于正当目的行事。'},

{ id:'u11q3', unit:11, type:'match', topic:'Sustainability Frameworks',
  en:'Match each sustainability concept to its description.',
  zh:'将每个可持续发展概念与其描述配对。',
  pairs:[
    {term:'ESG',                        def:'Environmental, Social, and Governance criteria'},
    {term:"Carroll's Pyramid",          def:'CSR: Economic→Legal→Ethical→Philanthropic'},
    {term:'Triple Bottom Line',         def:'People, Planet, and Profit framework'},
    {term:'Stakeholder Theory',         def:'Businesses create value for all affected parties'},
  ],
  pairsZh:[
    {term:'ESG',               def:'环境、社会和治理标准'},
    {term:'卡罗尔金字塔',       def:'CSR：经济→法律→道德→慈善'},
    {term:'三重底线',           def:'人、地球和利润框架'},
    {term:'利益相关者理论',     def:'企业为所有受影响方创造价值'},
  ],
  okEn:'Excellent! All sustainability frameworks correctly matched.',
  okZh:'优秀！所有可持续发展框架均正确匹配。',
  errEn:'Incorrect. Review the core sustainability frameworks.',
  errZh:'匹配错误。请复习核心可持续发展框架。'},

{ id:'u11q4', unit:11, type:'mcq', topic:'Whistleblower Protections',
  en:'Under the Corporations Act 2001, whistleblower protections apply to disclosures about:',
  zh:'根据《2001年公司法》，举报人保护适用于关于以下内容的披露：',
  opts:['Only fraud against the government','Misconduct, breach of the law, or financial crimes involving corporations','Personal grievances about working conditions','Tax avoidance by individuals'],
  optsZh:['仅针对政府的欺诈','涉及公司的不当行为、违法行为或金融犯罪','关于工作条件的个人申诉','个人避税'],
  ans:1,
  okEn:'Correct. Whistleblower protections under Part 9.4AAA of the Corporations Act cover disclosures of misconduct, legal breaches, financial crimes, and other improper conduct by corporations.',
  okZh:'正确。《公司法》第9.4AAA部分的举报人保护涵盖公司不当行为、违法行为、金融犯罪和其他不当行为的披露。',
  errEn:'Incorrect. Whistleblower protections cover misconduct, legal breaches, and financial crimes involving corporations.',
  errZh:'不正确。举报人保护涵盖涉及公司的不当行为、违法行为和金融犯罪。'},

{ id:'u11q5', unit:11, type:'tf', topic:'Profit and Sustainability',
  stmt:'According to the Triple Bottom Line concept, a company can be both profitable and environmentally sustainable simultaneously.',
  stmtZh:'根据三重底线概念，公司可以同时具有盈利性和环境可持续性。',
  ans:true,
  okEn:'Correct — TRUE. The TBL framework argues that sustainable business practices (People + Planet) can coexist with and even enhance long-term Profit.',
  okZh:'正确——真。三重底线框架认为，可持续的商业实践（人+地球）可以与长期利润共存，甚至提升长期利润。',
  errEn:'TRUE. The Triple Bottom Line shows profitability and sustainability are not mutually exclusive — sustainable practices can enhance long-term profit.',
  errZh:'真。三重底线表明盈利能力和可持续性并不互斥——可持续做法可以提升长期利润。'},

{ id:'u11q6', unit:11, type:'mcq', topic:'ASX Governance Principles',
  en:'Which of the following is NOT one of the ASX Corporate Governance Principles?',
  zh:'下列哪项不是ASX企业治理原则之一？',
  opts:['Lay solid foundations for management and oversight','Act ethically and responsibly','Maximise short-term returns to shareholders','Recognise and manage risk'],
  optsZh:['为管理和监督奠定坚实基础','道德地和负责任地行事','最大化对股东的短期回报','识别和管理风险'],
  ans:2,
  okEn:'Correct. "Maximise short-term returns" is NOT an ASX Governance Principle. The 8 principles focus on transparency, ethics, risk management, and accountability — not short-term profit maximisation.',
  okZh:'正确。"最大化短期回报"不是ASX治理原则。8项原则关注透明度、道德、风险管理和问责制——而非短期利润最大化。',
  errEn:'Incorrect. "Maximise short-term returns" is not an ASX Governance Principle — the principles focus on governance, ethics, and risk.',
  errZh:'不正确。"最大化短期回报"不是ASX治理原则——原则关注治理、道德和风险。'},
];

// ============================================================
//  DND QUESTION — Always last (Court Hierarchy)
// ============================================================
const DND_DRIVES = [
  { id:'hc',  label:'High Court of Australia',           labelCN:'澳大利亚高等法院',     icon:'⚖️' },
  { id:'fed', label:'Federal Court / Court of Appeal',   labelCN:'联邦法院/上诉法院',     icon:'🏛️' },
  { id:'sup', label:'Supreme Court (State/Territory)',   labelCN:'（州/领地）最高法院',   icon:'🔷' },
  { id:'dis', label:'District / County Court',           labelCN:'地区/县级法院',          icon:'📋' },
  { id:'mag', label:'Magistrates Court',                 labelCN:'治安法院',               icon:'📂' },
];
const DND_CORRECT_ORDER = ['hc','fed','sup','dis','mag'];

// ============================================================
//  GAME STATE
// ============================================================
const STATE = {
  score: 0,
  floor: 0,
  totalFloors: 0,
  queue: [],
  answered: false,
  topicsCovered: [],
  startTime: 0,
  dndSlots: {},
  dndDragId: null,
  matchSelectedTerm: null,
  matchPairs: [],
  matchMatched: 0,
};

const AEGIS_LINES = {
  boot:  ['AEGIS ONLINE. INITIALISING KNOWLEDGE VERIFICATION PROTOCOL...', 'CORPORATE ESCAPE PROTOCOL v3.0 INITIATED. PREPARE YOUR MIND, AGENT.', 'NEXCORP TOWER SECURITY ACTIVE. DEMONSTRATE YOUR KNOWLEDGE TO ESCAPE.'],
  correct: ['ACCESS GRANTED. NEURAL PATTERN VERIFIED. // 访问授权。神经模式已验证。', 'CORRECT DATA TRANSMISSION. PROCEEDING TO NEXT SECTOR. // 数据传输正确。继续下一区域。', 'KNOWLEDGE CONFIRMED. SECURITY BYPASS SUCCESSFUL. // 知识已确认。安全绕过成功。', 'IMPRESSIVE. YOUR LEGAL KNOWLEDGE IS EXCEPTIONAL. // 令人印象深刻。你的法律知识非凡。'],
  wrong:  ['ACCESS DENIED. INCORRECT DATA DETECTED. RECALIBRATING... // 访问被拒。检测到数据错误。重新校准中...', 'SECURITY BREACH ATTEMPT FAILED. REVIEW PROTOCOLS. // 安全突破尝试失败。复习协议。', 'SYSTEM ERROR. KNOWLEDGE GAP DETECTED. REPROCESSING... // 系统错误。检测到知识空白。重新处理中...'],
  trans:  ['ASCENDING TO NEXT SECURITY LEVEL... // 上升至下一安全级别...', 'ACCESSING NEXT DATA VAULT... // 访问下一数据库...', 'SECURITY DOOR UNLOCKED. PROCEEDING... // 安全门已解锁。继续...'],
  win:    ['ESCAPE SEQUENCE COMPLETE. ALL SECURITY LEVELS CLEARED. WELL DONE, AGENT! // 逃脱序列完成。所有安全级别已清除。干得好，特工！'],
};

function randItem(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

// ============================================================
//  DOM REFERENCES
// ============================================================
const GW       = document.getElementById('game-wrapper');
const hudFloor = document.getElementById('hud-floor');
const hudScore = document.getElementById('hud-score');
const hudClock = document.getElementById('hud-clock');
const hudProgress = document.getElementById('hud-progress');
const batteryBar  = document.getElementById('battery-bar');
const dialogueBox = document.getElementById('dialogue-box');
const dialogueTxt = document.getElementById('dialogue-text');
const dialogueCnt = document.getElementById('dialogue-continue');
const aegisSvg    = document.getElementById('aegis-svg');
const ftOverlay   = document.getElementById('floor-transition');
const ftText      = document.getElementById('ft-text');
const ftCn        = document.getElementById('ft-cn');
const ftBar       = document.getElementById('ft-bar');
const exitModal   = document.getElementById('exit-modal');

// ============================================================
//  SCREEN MANAGEMENT
// ============================================================
function showScreen(id, animClass) {
  document.querySelectorAll('.screen.active').forEach(s => {
    s.classList.remove('active');
    s.classList.remove('anim-boot','anim-wipe','anim-blinds','anim-zoom','anim-match','anim-win');
  });
  const s = document.getElementById(id);
  if (!s) return;
  s.classList.add('active');
  if (animClass) {
    s.classList.remove(animClass);
    void s.offsetWidth; // reflow
    s.classList.add(animClass);
  }
}

// ============================================================
//  TYPEWRITER EFFECT
// ============================================================
let typeTimer = null;
function typewrite(el, text, speed, cb) {
  if (typeTimer) clearInterval(typeTimer);
  el.innerHTML = '';
  let i = 0;
  typeTimer = setInterval(() => {
    if (i < text.length) {
      el.innerHTML = text.slice(0, i + 1) + '<span class="type-cursor">▋</span>';
      SoundFX.playType();
      i++;
    } else {
      clearInterval(typeTimer);
      el.innerHTML = text;
      if (cb) cb();
    }
  }, speed || 25);
}

// ============================================================
//  DIALOGUE BOX
// ============================================================
function showDialogue(text, showContinue) {
  dialogueBox.classList.remove('hidden');
  aegisSvg.classList.add('talking');
  aegisSvg.classList.remove('alarmed');
  typewrite(dialogueTxt, text, 22, () => {
    aegisSvg.classList.remove('talking');
    if (showContinue) dialogueCnt.style.display = 'block';
  });
  dialogueCnt.style.display = 'none';
}

function hideDialogue() {
  dialogueBox.classList.add('hidden');
  dialogueCnt.style.display = 'none';
}

// ============================================================
//  HUD UPDATE
// ============================================================
function updateHUD() {
  hudFloor.textContent = `FLOOR ${STATE.floor}/${STATE.totalFloors}`;
  hudScore.textContent = `SCR ${STATE.score}`;
  // Progress dots
  hudProgress.innerHTML = '';
  for (let i = 0; i < STATE.totalFloors; i++) {
    const dot = document.createElement('div');
    dot.className = 'prog-dot';
    if (i < STATE.floor) dot.classList.add('done');
    else if (i === STATE.floor) dot.classList.add('current');
    hudProgress.appendChild(dot);
  }
  // Battery (score-based)
  const segs = batteryBar.querySelectorAll('.battery-seg');
  const filled = Math.min(5, Math.round((STATE.score / (STATE.totalFloors * 10)) * 5));
  segs.forEach((s, idx) => {
    s.classList.toggle('empty', idx >= filled);
  });
}

function animateScore() {
  hudScore.classList.remove('bounce');
  void hudScore.offsetWidth;
  hudScore.classList.add('bounce');
  setTimeout(() => hudScore.classList.remove('bounce'), 400);
}

// ============================================================
//  CLOCK
// ============================================================
function startClock() {
  STATE.startTime = Date.now();
  setInterval(() => {
    const elapsed = Math.floor((Date.now() - STATE.startTime) / 1000);
    const h = String(Math.floor(elapsed / 3600)).padStart(2,'0');
    const m = String(Math.floor((elapsed % 3600) / 60)).padStart(2,'0');
    const s = String(elapsed % 60).padStart(2,'0');
    hudClock.textContent = `${h}:${m}:${s}`;
  }, 1000);
}

// ============================================================
//  PARTICLES
// ============================================================
function initParticles() {
  const canvas = document.getElementById('particles-canvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  let W, H, particles = [];
  function resize() {
    W = canvas.width  = GW.offsetWidth;
    H = canvas.height = GW.offsetHeight;
  }
  resize();
  new ResizeObserver(resize).observe(GW);
  for (let i = 0; i < 60; i++) {
    particles.push({ x: Math.random()*W, y: Math.random()*H, r: Math.random()*1.5+0.3, vx: (Math.random()-0.5)*0.3, vy: -Math.random()*0.4-0.1, a: Math.random() });
  }
  function draw() {
    ctx.clearRect(0,0,W,H);
    particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fillStyle = `rgba(0,255,255,${0.15 + Math.sin(p.a)*0.1})`;
      ctx.fill();
      p.x += p.vx; p.y += p.vy; p.a += 0.02;
      if (p.y < 0) { p.y = H; p.x = Math.random()*W; }
    });
    requestAnimationFrame(draw);
  }
  draw();
}

// ============================================================
//  OVERLAYS
// ============================================================
function showCorrectOverlay() {
  const o = document.getElementById('correct-overlay');
  o.classList.remove('hidden');
  GW.style.boxShadow = '0 0 80px rgba(0,255,128,0.4), 0 0 200px rgba(0,200,80,0.2)';
  setTimeout(() => {
    o.classList.add('hidden');
    GW.style.boxShadow = '';
  }, 800);
}
function showWrongOverlay() {
  const o = document.getElementById('wrong-overlay');
  o.classList.remove('hidden');
  GW.classList.remove('shake');
  void GW.offsetWidth;
  GW.classList.add('shake');
  GW.style.boxShadow = '0 0 80px rgba(255,0,0,0.35), inset 0 0 80px rgba(255,0,0,0.15)';
  aegisSvg.classList.add('alarmed');
  setTimeout(() => {
    o.classList.add('hidden');
    GW.classList.remove('shake');
    GW.style.boxShadow = '';
    aegisSvg.classList.remove('alarmed');
  }, 600);
}

// ============================================================
//  FLOOR TRANSITION
// ============================================================
function floorTransition(text, textCn, cb) {
  ftOverlay.classList.remove('hidden');
  ftText.textContent = text;
  ftCn.textContent = textCn;
  ftBar.style.width = '0%';
  SoundFX.playTransition();
  setTimeout(() => { ftBar.style.width = '100%'; }, 50);
  setTimeout(() => {
    ftOverlay.classList.add('hidden');
    ftBar.style.width = '0%';
    if (cb) cb();
  }, 900);
}

// ============================================================
//  QUEUE BUILDING
// ============================================================
function buildQueue() {
  // Shuffle QUESTION_BANK, pick 9 with unit interleaving
  const shuffled = [...QUESTION_BANK].sort(() => Math.random() - 0.5);
  const selected = [];
  let lastUnit = -1;
  // Try to interleave — first pass preferring different units
  for (const q of shuffled) {
    if (selected.length >= 9) break;
    if (q.unit !== lastUnit) {
      selected.push(q);
      lastUnit = q.unit;
    }
  }
  // Fill remaining if needed
  for (const q of shuffled) {
    if (selected.length >= 9) break;
    if (!selected.includes(q)) selected.push(q);
  }
  // DnD is always last
  selected.push({ id:'dnd', unit:2, type:'dnd', topic:'Court Hierarchy', en:'Court Hierarchy Drag and Drop' });
  return selected;
}

// ============================================================
//  INIT GAME
// ============================================================
function initGame() {
  STATE.score = 0;
  STATE.floor = 0;
  STATE.topicsCovered = [];
  STATE.answered = false;
  STATE.queue = buildQueue();
  STATE.totalFloors = STATE.queue.length;
  updateHUD();
  startClock();
  runBoot();
}

// ============================================================
//  BOOT SEQUENCE
// ============================================================
const BOOT_LINES = [
  'NEXCORP SECURITY SYSTEM v3.0 — INITIALISING...',
  'LOADING KNOWLEDGE VERIFICATION MODULES...',
  'AEGIS AI CORE: ONLINE',
  'BIOMETRIC AUTHENTICATION: BYPASSED',
  'LOADING LEGAL DATABASE... 63 MODULES DETECTED',
  'ESCAPE ROUTE: LOCKED — KNOWLEDGE KEY REQUIRED',
  'ALL SYSTEMS NOMINAL. AWAITING AGENT INPUT.',
];
function runBoot() {
  showScreen('screen-boot', 'anim-boot');
  hideDialogue();
  const terminal = document.getElementById('boot-terminal');
  const prompt   = document.getElementById('boot-prompt');
  terminal.innerHTML = '';
  prompt.style.display = 'none';
  SoundFX.playBoot();
  BOOT_LINES.forEach((line, i) => {
    setTimeout(() => {
      const span = document.createElement('div');
      span.className = 'bt-line';
      span.textContent = '> ' + line;
      terminal.appendChild(span);
      if (i === BOOT_LINES.length - 1) {
        setTimeout(() => { prompt.style.display = ''; }, 300);
      }
    }, 400 + i * 280);
  });
}

function startGame() {
  SoundFX.playTransition();
  floorTransition('INITIATING ESCAPE PROTOCOL...', '启动逃脱协议...', () => {
    showDialogue(randItem(AEGIS_LINES.boot), false);
    showNextQuestion();
  });
}

// ============================================================
//  SHOW NEXT QUESTION
// ============================================================
function showNextQuestion() {
  if (STATE.floor >= STATE.queue.length) {
    showWinScreen();
    return;
  }
  const q = STATE.queue[STATE.floor];
  STATE.answered = false;
  if (!STATE.topicsCovered.includes(`${UNIT_NAMES[q.unit]}: ${q.topic}`)) {
    STATE.topicsCovered.push(`${UNIT_NAMES[q.unit]}: ${q.topic}`);
  }
  updateHUD();

  const floorLabel = STATE.floor < STATE.queue.length - 1 
    ? `FLOOR ${String(STATE.floor + 1).padStart(2,'0')} // SECURITY LEVEL ${STATE.floor + 1}`
    : `FINAL FLOOR // MAINFRAME CORE`;

  switch (q.type) {
    case 'mcq':
    case 'scenario': showMCQScreen(q, floorLabel); break;
    case 'tf':       showTFScreen(q, floorLabel);  break;
    case 'fill':     showFillScreen(q, floorLabel); break;
    case 'match':    showMatchScreen(q, floorLabel); break;
    case 'dnd':      showDNDScreen(); break;
  }
}

// ============================================================
//  MCQ / SCENARIO SCREEN
// ============================================================
function showMCQScreen(q, floorLabel) {
  const panel   = document.getElementById('question-panel');
  const unitTag = document.getElementById('q-unit-tag');
  const header  = document.getElementById('q-floor-header');
  const qText   = document.getElementById('q-text');
  const mcqGrid = document.getElementById('q-mcq-answers');
  const tfBtns  = document.getElementById('q-tf-buttons');
  const fillArea = document.getElementById('q-fill-area');
  const feedback = document.getElementById('q-feedback');
  const cont     = document.getElementById('q-continue');

  // Set unit color
  const color = UNIT_COLORS[q.unit] || '#0ff';
  panel.style.setProperty('--unit-color', `linear-gradient(90deg, transparent, ${color}, transparent)`);
  unitTag.textContent  = UNIT_NAMES[q.unit];
  unitTag.style.color  = color;
  unitTag.style.borderColor = color;
  header.innerHTML = `&#9672;&nbsp; ${floorLabel} &nbsp;&#9672;`;
  
  // Build question text
  let questionHTML = '';
  if (q.type === 'scenario') {
    questionHTML += `<div class="scenario-box">${q.scenario}<span class="cn-text">${q.scenarioZh}</span></div>`;
  }
  questionHTML += q.en + `<span class="cn-text">${q.zh}</span>`;
  qText.innerHTML = questionHTML;

  // Show MCQ, hide others
  mcqGrid.classList.remove('hidden');
  tfBtns.classList.add('hidden');
  fillArea.classList.add('hidden');
  feedback.classList.add('hidden');
  cont.classList.add('hidden');
  mcqGrid.innerHTML = '';

  q.opts.forEach((opt, idx) => {
    const btn = document.createElement('button');
    btn.className = 'answer-btn';
    btn.innerHTML = `<strong>${String.fromCharCode(65+idx)}.</strong> ${opt}<span class="cn-text">${q.optsZh[idx]}</span>`;
    btn.addEventListener('mouseenter', () => SoundFX.playClick());
    btn.addEventListener('click', () => {
      if (STATE.answered) return;
      STATE.answered = true;
      handleMCQAnswer(q, idx);
    });
    mcqGrid.appendChild(btn);
  });

  const animClass = q.type === 'scenario' ? 'anim-blinds' : 'anim-wipe';
  showScreen('screen-question', animClass);
}

function handleMCQAnswer(q, selectedIdx) {
  const btns = document.querySelectorAll('#q-mcq-answers .answer-btn');
  btns.forEach(b => b.disabled = true);
  const correct = (selectedIdx === q.ans);
  btns[q.ans].classList.add('correct');
  if (!correct) btns[selectedIdx].classList.add('wrong');

  const fb = document.getElementById('q-feedback');
  fb.classList.remove('hidden', 'ok', 'err');
  if (correct) {
    fb.className = 'feedback-msg ok';
    fb.innerHTML = `&#10003; ${q.okEn}<span class="cn-text">${q.okZh}</span>`;
    STATE.score += 10;
    animateScore();
    showCorrectOverlay();
    SoundFX.playCorrect();
    showDialogue(randItem(AEGIS_LINES.correct), false);
  } else {
    fb.className = 'feedback-msg err';
    fb.innerHTML = `&#10007; ${q.errEn}<span class="cn-text">${q.errZh}</span>`;
    showWrongOverlay();
    SoundFX.playWrong();
    showDialogue(randItem(AEGIS_LINES.wrong), false);
    // Spaced repetition: requeue 3 positions later
    requeueWrong(q);
  }
  document.getElementById('q-continue').classList.remove('hidden');
}

// ============================================================
//  TRUE/FALSE SCREEN
// ============================================================
function showTFScreen(q, floorLabel) {
  const panel   = document.getElementById('question-panel');
  const unitTag = document.getElementById('q-unit-tag');
  const header  = document.getElementById('q-floor-header');
  const qText   = document.getElementById('q-text');
  const mcqGrid = document.getElementById('q-mcq-answers');
  const tfBtns  = document.getElementById('q-tf-buttons');
  const fillArea = document.getElementById('q-fill-area');
  const feedback = document.getElementById('q-feedback');
  const cont     = document.getElementById('q-continue');

  const color = UNIT_COLORS[q.unit] || '#0ff';
  panel.style.setProperty('--unit-color', `linear-gradient(90deg, transparent, ${color}, transparent)`);
  unitTag.textContent = UNIT_NAMES[q.unit];
  unitTag.style.color = color;
  unitTag.style.borderColor = color;
  header.innerHTML = `&#9672;&nbsp; ${floorLabel} — TRUE OR FALSE &nbsp;&#9672;`;

  qText.innerHTML = `<em style="color:#ff0;font-size:0.8em;letter-spacing:2px;">TRUE OR FALSE? // 真或假？</em><br><br>${q.stmt}<span class="cn-text">${q.stmtZh}</span>`;

  mcqGrid.classList.add('hidden');
  tfBtns.classList.remove('hidden');
  fillArea.classList.add('hidden');
  feedback.classList.add('hidden');
  cont.classList.add('hidden');

  const trueBtn  = document.getElementById('tf-true');
  const falseBtn = document.getElementById('tf-false');
  trueBtn.disabled = false;
  falseBtn.disabled = false;
  trueBtn.className  = 'tf-btn true-btn';
  falseBtn.className = 'tf-btn false-btn';

  function handleTF(chosen) {
    if (STATE.answered) return;
    STATE.answered = true;
    trueBtn.disabled = true;
    falseBtn.disabled = true;
    const correct = (chosen === q.ans);
    if (correct) {
      (chosen ? trueBtn : falseBtn).classList.add('correct');
      feedback.className = 'feedback-msg ok';
      feedback.innerHTML = `&#10003; ${q.okEn}<span class="cn-text">${q.okZh}</span>`;
      STATE.score += 10;
      animateScore();
      showCorrectOverlay();
      SoundFX.playCorrect();
      showDialogue(randItem(AEGIS_LINES.correct), false);
    } else {
      (chosen ? trueBtn : falseBtn).classList.add('wrong');
      (q.ans ? trueBtn : falseBtn).classList.add('correct');
      feedback.className = 'feedback-msg err';
      feedback.innerHTML = `&#10007; ${q.errEn}<span class="cn-text">${q.errZh}</span>`;
      showWrongOverlay();
      SoundFX.playWrong();
      showDialogue(randItem(AEGIS_LINES.wrong), false);
      requeueWrong(q);
    }
    feedback.classList.remove('hidden');
    cont.classList.remove('hidden');
  }

  trueBtn.onclick  = () => handleTF(true);
  falseBtn.onclick = () => handleTF(false);

  showScreen('screen-question', 'anim-blinds');
}

// ============================================================
//  FILL IN BLANK SCREEN
// ============================================================
function showFillScreen(q, floorLabel) {
  const panel   = document.getElementById('question-panel');
  const unitTag = document.getElementById('q-unit-tag');
  const header  = document.getElementById('q-floor-header');
  const qText   = document.getElementById('q-text');
  const mcqGrid = document.getElementById('q-mcq-answers');
  const tfBtns  = document.getElementById('q-tf-buttons');
  const fillArea = document.getElementById('q-fill-area');
  const feedback = document.getElementById('q-feedback');
  const cont     = document.getElementById('q-continue');
  const fillInput  = document.getElementById('fill-input');
  const fillSubmit = document.getElementById('fill-submit');
  const fillHint   = document.getElementById('fill-hint');

  const color = UNIT_COLORS[q.unit] || '#0ff';
  panel.style.setProperty('--unit-color', `linear-gradient(90deg, transparent, ${color}, transparent)`);
  unitTag.textContent = UNIT_NAMES[q.unit];
  unitTag.style.color = color;
  unitTag.style.borderColor = color;
  header.innerHTML = `&#9672;&nbsp; ${floorLabel} — FILL IN THE BLANK &nbsp;&#9672;`;

  // Format blank with highlighted underline
  const formatted = q.blank.replace('___', '<span class="fill-blank-highlight">___</span>');
  qText.innerHTML = formatted + `<span class="cn-text">${q.blankZh}</span>`;
  fillHint.textContent = 'Type your answer and press SUBMIT or ENTER // 输入答案并按提交或回车';

  mcqGrid.classList.add('hidden');
  tfBtns.classList.add('hidden');
  fillArea.classList.remove('hidden');
  feedback.classList.add('hidden');
  cont.classList.add('hidden');

  fillInput.value = '';
  fillInput.disabled = false;
  fillInput.style.borderColor = '';
  fillSubmit.disabled = false;

  function handleFill() {
    if (STATE.answered) return;
    const val = fillInput.value.trim().toLowerCase();
    if (!val) return;
    STATE.answered = true;
    fillInput.disabled = true;
    fillSubmit.disabled = true;
    const correct = q.accepts.some(a => a.toLowerCase() === val);
    if (correct) {
      fillInput.style.borderColor = '#0f8';
      feedback.className = 'feedback-msg ok';
      feedback.innerHTML = `&#10003; ${q.okEn}<span class="cn-text">${q.okZh}</span>`;
      STATE.score += 10;
      animateScore();
      showCorrectOverlay();
      SoundFX.playCorrect();
      showDialogue(randItem(AEGIS_LINES.correct), false);
    } else {
      fillInput.style.borderColor = '#f44';
      feedback.className = 'feedback-msg err';
      feedback.innerHTML = `&#10007; ${q.errEn}<span class="cn-text">${q.errZh}</span>`;
      showWrongOverlay();
      SoundFX.playWrong();
      showDialogue(randItem(AEGIS_LINES.wrong), false);
      requeueWrong(q);
    }
    feedback.classList.remove('hidden');
    cont.classList.remove('hidden');
  }

  fillSubmit.onclick = handleFill;
  fillInput.onkeydown = e => { if (e.key === 'Enter') handleFill(); };

  showScreen('screen-question', 'anim-zoom');
  setTimeout(() => fillInput.focus(), 500);
}

// ============================================================
//  MATCHING SCREEN
// ============================================================
function showMatchScreen(q, floorLabel) {
  const panel   = document.getElementById('match-panel');
  const unitTag = document.getElementById('match-unit-tag');
  const header  = document.getElementById('match-floor-header');
  const termsEl = document.getElementById('match-terms');
  const defsEl  = document.getElementById('match-defs');
  const feedback = document.getElementById('match-feedback');
  const cont     = document.getElementById('match-continue');

  const color = UNIT_COLORS[q.unit] || '#0ff';
  panel.style.setProperty('--unit-color', `linear-gradient(90deg, transparent, ${color}, transparent)`);
  unitTag.textContent = UNIT_NAMES[q.unit];
  unitTag.style.color = color;
  unitTag.style.borderColor = color;
  header.innerHTML = `&#9672;&nbsp; ${floorLabel} — MATCH PAIRS &nbsp;&#9672;`;

  feedback.classList.add('hidden');
  cont.classList.add('hidden');
  STATE.matchSelectedTerm = null;
  STATE.matchMatched = 0;

  // Build shuffled pairs
  const pairs = q.pairs.map((p, i) => ({ ...p, id: i }));
  const shuffledDefs = [...pairs].sort(() => Math.random() - 0.5);
  STATE.matchPairs = pairs;

  termsEl.innerHTML = '';
  defsEl.innerHTML  = '';

  pairs.forEach(p => {
    const el = document.createElement('div');
    el.className = 'match-item';
    el.dataset.id = p.id;
    el.dataset.role = 'term';
    el.textContent = p.term;
    el.addEventListener('mouseenter', () => SoundFX.playClick());
    el.addEventListener('click', () => selectTerm(el, p.id));
    termsEl.appendChild(el);
  });

  shuffledDefs.forEach(p => {
    const el = document.createElement('div');
    el.className = 'match-item';
    el.dataset.id = p.id;
    el.dataset.role = 'def';
    el.textContent = p.def;
    el.addEventListener('mouseenter', () => SoundFX.playClick());
    el.addEventListener('click', () => selectDef(el, p.id));
    defsEl.appendChild(el);
  });

  showScreen('screen-match', 'anim-match');
  showDialogue(`MATCH PAIRS TO VERIFY KNOWLEDGE. ${q.en} // ${q.zh}`, false);
}

function selectTerm(el, id) {
  if (el.classList.contains('matched-correct') || el.classList.contains('disabled-item')) return;
  document.querySelectorAll('#match-terms .match-item').forEach(t => t.classList.remove('selected'));
  el.classList.add('selected');
  STATE.matchSelectedTerm = id;
}

function selectDef(el, defId) {
  if (STATE.matchSelectedTerm == null) return;
  if (el.classList.contains('matched-correct') || el.classList.contains('disabled-item')) return;
  const termId = STATE.matchSelectedTerm;
  if (termId === null || termId === undefined) return;

  const termEl = document.querySelector(`#match-terms .match-item[data-id="${termId}"]`);
  const correct = (termId === defId);

  if (correct) {
    if (termEl) { termEl.classList.remove('selected'); termEl.classList.add('matched-correct','disabled-item'); }
    el.classList.add('matched-correct','disabled-item');
    STATE.matchMatched++;
    SoundFX.playCorrect();
    STATE.score += 3;
    animateScore();
    if (STATE.matchMatched === STATE.matchPairs.length) {
      const q = STATE.queue[STATE.floor];
      const fb = document.getElementById('match-feedback');
      fb.className = 'feedback-msg ok';
      fb.innerHTML = `&#10003; ${q.okEn}<span class="cn-text">${q.okZh}</span>`;
      fb.classList.remove('hidden');
      document.getElementById('match-continue').classList.remove('hidden');
      showCorrectOverlay();
      showDialogue(randItem(AEGIS_LINES.correct), false);
    }
  } else {
    if (termEl) { termEl.classList.remove('selected'); termEl.classList.add('matched-wrong'); }
    el.classList.add('matched-wrong');
    SoundFX.playWrong();
    showWrongOverlay();
    setTimeout(() => {
      if (termEl) termEl.classList.remove('matched-wrong');
      el.classList.remove('matched-wrong');
    }, 600);
  }
  STATE.matchSelectedTerm = null;
}

// ============================================================
//  DND SCREEN
// ============================================================
function showDNDScreen() {
  const drivesContainer = document.getElementById('drives-container');
  const slotsContainer  = document.getElementById('slots-container');
  drivesContainer.innerHTML = '';
  slotsContainer.innerHTML  = '';
  STATE.dndSlots = { 1:null, 2:null, 3:null, 4:null, 5:null };

  // Shuffle drives
  const shuffled = [...DND_DRIVES].sort(() => Math.random() - 0.5);
  shuffled.forEach(d => {
    const el = document.createElement('div');
    el.className = 'data-drive';
    el.id = 'drive-' + d.id;
    el.draggable = true;
    el.innerHTML = `<span class="drive-icon">${d.icon}</span><span class="drive-label">${d.label}<span class="cn-text">${d.labelCN}</span></span>`;
    el.addEventListener('dragstart', e => { STATE.dndDragId = d.id; el.classList.add('dragging'); SoundFX.playDrag(); e.dataTransfer.effectAllowed = 'move'; });
    el.addEventListener('dragend',   () => { el.classList.remove('dragging'); STATE.dndDragId = null; });
    drivesContainer.appendChild(el);
  });

  // Create slots
  for (let i = 1; i <= 5; i++) {
    const slot = document.createElement('div');
    slot.className = 'server-slot';
    slot.id = 'slot-' + i;
    slot.dataset.slot = i;
    slot.innerHTML = `<span class="slot-num">${i}</span><span class="slot-content"><span class="slot-empty-label">EMPTY SLOT ${i} // 空槽位</span></span>`;
    slot.addEventListener('dragover',  e => { e.preventDefault(); slot.classList.add('drag-over'); });
    slot.addEventListener('dragleave', () => slot.classList.remove('drag-over'));
    slot.addEventListener('drop',      e => { e.preventDefault(); slot.classList.remove('drag-over'); dropOnSlot(i); });
    slotsContainer.appendChild(slot);
  }

  document.getElementById('dnd-submit-btn').onclick = submitDND;
  document.getElementById('dnd-reset-btn').onclick  = resetDND;
  document.getElementById('dnd-feedback').classList.add('hidden');

  showScreen('screen-floordnd', 'anim-wipe');
  showDialogue('FINAL CHALLENGE: Arrange the Australian Court Hierarchy. Slot 1 = HIGHEST authority. // 最终挑战：排列澳大利亚法院层级。插槽1=最高权威。', false);
}

function dropOnSlot(slotNum) {
  const driveId = STATE.dndDragId;
  if (!driveId) return;
  // Remove drive from any previous slot
  Object.keys(STATE.dndSlots).forEach(k => {
    if (STATE.dndSlots[k] === driveId) STATE.dndSlots[k] = null;
  });
  // Remove drive from drives col if placed
  const drive = document.getElementById('drive-' + driveId);
  if (!drive) return;
  STATE.dndSlots[slotNum] = driveId;
  SoundFX.playDrop();

  // Update slot display
  const slot = document.getElementById('slot-' + slotNum);
  const dDef = DND_DRIVES.find(d => d.id === driveId);
  slot.className = 'server-slot filled';
  slot.innerHTML = `<span class="slot-num">${slotNum}</span><span class="slot-content">${dDef.label}<span class="cn-text">${dDef.labelCN}</span></span><button class="remove-btn" onclick="removeDriveFromSlot(${slotNum})">&#10005;</button>`;

  drive.classList.add('placed');
}

function removeDriveFromSlot(slotNum) {
  const driveId = STATE.dndSlots[slotNum];
  if (!driveId) return;
  STATE.dndSlots[slotNum] = null;
  const drive = document.getElementById('drive-' + driveId);
  if (drive) drive.classList.remove('placed');
  const slot = document.getElementById('slot-' + slotNum);
  slot.className = 'server-slot';
  slot.innerHTML = `<span class="slot-num">${slotNum}</span><span class="slot-content"><span class="slot-empty-label">EMPTY SLOT ${slotNum} // 空槽位</span></span>`;
}

function submitDND() {
  const fb = document.getElementById('dnd-feedback');
  // Check all slots filled
  for (let i = 1; i <= 5; i++) {
    if (!STATE.dndSlots[i]) {
      fb.className = 'feedback-msg err';
      fb.innerHTML = '&#10007; Fill ALL 5 slots before submitting. // 提交前请填写所有5个插槽。';
      fb.classList.remove('hidden');
      return;
    }
  }
  let allCorrect = true;
  for (let i = 1; i <= 5; i++) {
    const slot = document.getElementById('slot-' + i);
    if (STATE.dndSlots[i] === DND_CORRECT_ORDER[i-1]) {
      slot.classList.add('correct-slot');
    } else {
      slot.classList.add('wrong-slot');
      allCorrect = false;
    }
  }
  if (allCorrect) {
    fb.className = 'feedback-msg ok';
    fb.innerHTML = '&#10003; PERFECT! Correct hierarchy: High Court → Federal/CoA → Supreme → District → Magistrates // 完美！正确层级：高等法院 → 联邦/上诉法院 → 最高法院 → 地区法院 → 治安法院';
    STATE.score += 20;
    animateScore();
    showCorrectOverlay();
    SoundFX.playCorrect();
    fb.classList.remove('hidden');
    document.getElementById('dnd-submit-btn').disabled = true;
    setTimeout(() => advanceFloor(), 2000);
  } else {
    fb.className = 'feedback-msg err';
    fb.innerHTML = '&#10007; Some courts are in the wrong order. Check and try again. // 部分法院顺序有误，请检查并重试。';
    fb.classList.remove('hidden');
    showWrongOverlay();
    SoundFX.playWrong();
    // Reset wrong slots after delay
    setTimeout(() => {
      for (let i = 1; i <= 5; i++) {
        document.getElementById('slot-' + i).classList.remove('correct-slot','wrong-slot');
      }
    }, 1000);
  }
}

function resetDND() {
  for (let i = 1; i <= 5; i++) {
    removeDriveFromSlot(i);
  }
  document.getElementById('dnd-feedback').classList.add('hidden');
  document.getElementById('dnd-submit-btn').disabled = false;
}

// ============================================================
//  SPACED REPETITION
// ============================================================
function requeueWrong(q) {
  // Don't requeue if already a retry or it's the DnD question
  if (q.id === 'dnd' || q._retry) return;
  const insertPos = Math.min(STATE.floor + 4, STATE.queue.length);
  const retryQ = { ...q, _retry: true };
  STATE.queue.splice(insertPos, 0, retryQ);
  STATE.totalFloors = STATE.queue.length;
  updateHUD();
}

// ============================================================
//  ADVANCE FLOOR
// ============================================================
function advanceFloor() {
  STATE.floor++;
  if (STATE.floor >= STATE.queue.length) {
    showWinScreen();
    return;
  }
  const q = STATE.queue[STATE.floor];
  const isLast = (STATE.floor === STATE.queue.length - 1 && q.type === 'dnd');
  const tText = isLast ? 'FINAL FLOOR — MAINFRAME CORE' : `ACCESSING FLOOR ${String(STATE.floor + 1).padStart(2,'0')}...`;
  const tCn   = isLast ? '最终层——主机核心' : `正在访问第${STATE.floor + 1}层...`;
  floorTransition(tText, tCn, () => {
    showDialogue(randItem(AEGIS_LINES.trans), false);
    showNextQuestion();
  });
}

// ============================================================
//  WIN SCREEN
// ============================================================
function showWinScreen() {
  SoundFX.playWin();
  showScreen('screen-win', 'anim-win');
  hideDialogue();

  const elapsed = Math.floor((Date.now() - STATE.startTime) / 1000);
  const m = Math.floor(elapsed / 60);
  const s = elapsed % 60;
  document.getElementById('win-stats').textContent =
    `SCORE: ${STATE.score} pts  |  TIME: ${m}m ${s}s  |  FLOORS: ${STATE.floor}  |  QUESTIONS ATTEMPTED: ${STATE.queue.length}`;

  const list = document.getElementById('win-knowledge-list');
  list.innerHTML = STATE.topicsCovered.map(t => `<div>&#9654; ${t}</div>`).join('');

  setTimeout(() => showDialogue(AEGIS_LINES.win[0], false), 1000);
}

// ============================================================
//  EXIT BUTTON & MODAL
// ============================================================
document.getElementById('exit-btn').addEventListener('click', () => {
  SoundFX.playClick();
  exitModal.classList.remove('hidden');
});
document.getElementById('exit-yes').addEventListener('click', () => {
  window.location.href = 'index.html?skip_intro=true';
});
document.getElementById('exit-no').addEventListener('click', () => {
  SoundFX.playClick();
  exitModal.classList.add('hidden');
});

// ============================================================
//  FULLSCREEN
// ============================================================
function enterFullscreen() {
  const el = document.documentElement;
  try {
    if      (el.requestFullscreen)       el.requestFullscreen();
    else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    else if (el.mozRequestFullScreen)    el.mozRequestFullScreen();
  } catch(e) {}
}
document.addEventListener('fullscreenchange', () => {
  if (document.fullscreenElement) {
    GW.style.maxWidth  = 'none';
    GW.style.maxHeight = 'none';
  } else {
    GW.style.maxWidth  = '1600px';
    GW.style.maxHeight = '900px';
  }
});
document.addEventListener('keydown', e => {
  if (e.key === 'Escape' && document.fullscreenElement) {
    try { document.exitFullscreen(); } catch(e2) {}
  }
});

// ============================================================
//  CONTINUE BUTTONS
// ============================================================
document.getElementById('q-continue').addEventListener('click', () => {
  SoundFX.playClick();
  advanceFloor();
});
document.getElementById('match-continue').addEventListener('click', () => {
  SoundFX.playClick();
  advanceFloor();
});
document.getElementById('replay-btn').addEventListener('click', () => {
  SoundFX.playClick();
  initGame();
});

// ============================================================
//  BOOT SCREEN — start on any key/click
// ============================================================
function onBootStart(e) {
  const prompt = document.getElementById('boot-prompt');
  const bootScreen = document.getElementById('screen-boot');
  if (bootScreen.classList.contains('active') && prompt.style.display !== 'none') {
    document.removeEventListener('keydown', onBootStart);
    bootScreen.removeEventListener('click', onBootStart);
    enterFullscreen();
    startGame();
  }
}
document.addEventListener('keydown', onBootStart);
document.getElementById('screen-boot').addEventListener('click', onBootStart);

// ============================================================
//  INITIALISE
// ============================================================
initParticles();
initGame();
</script>
</body>
</html>
